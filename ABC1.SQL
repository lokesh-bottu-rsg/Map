weeklyMapPlannedProjectsData: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_MODEL_TYPE AS(
											select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
											FROM CTE_PLAN_TYPE
									)
									,CTE_PAST_PLAN  AS (
											SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PLAN_TYPE CP ON 1=1
											WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
											JOIN CTE_PLAN_TYPE CP ON 1=1 
											WHERE PP.PLAN_ID=CP.PLAN_ID AND PP.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
											AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
									)
									,CTE_VERSION_ID AS(
											SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
											JOIN CTE_PARAM CP ON 1=1
											WHERE MD.PLAN_ID=CP.PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											JOIN CTE_PARAM CP ON 1=1 WHERE RMD.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	  
									,CTE_FUTURE_ENDDATE AS (
											select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
											JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
									)
									,CTE_FUTURE_ID AS(
											SELECT PR.PLAN_ID AS FUTURE_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											where PERIOD_ID=CF.FUTURE_PERIOD_ID and PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											and PR.PLAN_TYPE = CT.PLAN_TYPE LIMIT 1
									)
									,CTE_MAP_END_DATE AS (    
											select END_DATE AS V_MAP_END_DATE 
											from REF_CAL_PERIOD RF
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											where PERIOD_ID= CF.FUTURE_PERIOD_ID
									)
									,CTE_PAST_PLAN_ID AS(
											SELECT DISTINCT PPS.PLAN_ID, PPS.PLAN_VERSION_ID, PPS.PROJECT_ID, PPS.ACTIVE_YN, PPS.MEDIA_OUTLET_ID, 
											PPS.CAMPAIGN_GOAL_ID CAMPAIGN_GOAL_ID, 'N' AS IS_EPISODIC 
											FROM PR_PLAN_SCHEDULE PPS 
											JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and PPS.PLAN_VERSION_ID=0 and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											AND P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
											AND PPS.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPS.ACTIVE_YN='Y'
											
											UNION
											
											SELECT DISTINCT PPSE.PLAN_ID, PPSE.PLAN_VERSION_ID, PPSE.PROJECT_ID, PPSE.ACTIVE_YN, PPSE.MEDIA_OUTLET_ID,
											PPSE.CAMPAIGN_GOAL_ID CAMPAIGN_GOAL_ID, 'Y' AS IS_EPISODIC
											FROM PR_PLAN_SCHEDULE_EPISODE PPSE 
											JOIN PR_PLAN P on P.PLAN_ID=PPSE.PLAN_ID and PPSE.PLAN_VERSION_ID=0 
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											WHERE P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											AND PPSE.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPSE.ACTIVE_YN='Y'
											AND not exists
											(
											SELECT 1 FROM PR_PLAN_SCHEDULE PPS1
											JOIN CTE_PARAM CP ON PPS1.PLAN_ID=CP.PLAN_ID
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											JOIN PR_PLAN P on P.PLAN_ID=PPS1.PLAN_ID and PPS1.PLAN_VERSION_ID=0 and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
											AND PPS1.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPS1.ACTIVE_YN='Y'
											WHERE PPSE.PROJECT_ID=PPS1.PROJECT_ID
											)
									)
									,CTE_PLANNED_DATA AS (  
													SELECT 
													CP.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PCG.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													CASE WHEN CP.OUTPUT_TYPE=1 THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END UNITS,
													PPS.START_DATE,
													PPS.END_DATE,
													PCG.START_DATE AS PROJ_START_DATE,
													PCG.END_DATE AS PROJ_END_DATE,
													RCT.NAME TYPE,
													PPR.NAME PROJECT_NAME,
													'N' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS.PLANNED_GRP) PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP,
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM 
													PR_PLAN_SCHEDULE PPS 
													JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
													JOIN CTE_VERSION_ID CV ON 1=1
													JOIN PR_PROJECT PPR ON PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE
													AND PPR.PROJECT_ID = PPS.PROJECT_ID 
													AND PPS.ACTIVE_YN='Y'
													and PPS.PLAN_ID=CP.PLAN_ID
													JOIN PR_CAMPAIGN_GOAL PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID
													AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
													AND PPS.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
													JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
													AND PPP.PROJECT_ID=PPS.PROJECT_ID
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN  REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		-- change 2.7.5 additional
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PCG.FREQUENCY,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,				                    RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,CP.OUTPUT_TYPE,PPS.START_DATE,PPS.END_DATE,PCG.START_DATE,PCG.END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,
													PPP.DISPLAY_SEQ,PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,RD.NAME,        
													PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,
													PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,PPP.PHASE_TYPE,RPT.DESCRIPTION ,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.PLAN_ID


									UNION
														
													SELECT 
													CP.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PPP.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													0 UNITS,
													MIN(PPS.START_DATE) AS START_DATE,
													MIN(PPS.END_DATE) AS END_DATE,
													PPP.ON_MAP_START_DATE AS PROJ_START_DATE,
													PPP.ON_MAP_END_DATE AS PROJ_END_DATE,
													RCT.NAME TYPE,
													PPR.NAME PROJECT_NAME,
													'N' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													0 PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													MAX(RC.CLUSTER_NAME) AS CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM 
													PR_PLAN_SCHEDULE_EPISODE PPS 
													JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
													JOIN CTE_VERSION_ID CV ON 1=1
													JOIN PR_PROJECT PPR ON PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE
													AND PPR.PROJECT_ID = PPS.PROJECT_ID  
													AND PPS.ACTIVE_YN='Y'
													and PPS.PLAN_ID=CP.PLAN_ID 
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
													AND PPP.PROJECT_ID=PPS.PROJECT_ID 
													AND PPS.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON PPP.ON_MAP_DEMO = RD.DEMO_ID
													JOIN REF_SEGMENT RS ON PPP.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN  REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													LEFT JOIN (SELECT DISTINCT PROJECT_ID FROM PR_PLAN_SCHEDULE PPS 
															JOIN CTE_PARAM CP ON 1=1
															WHERE PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE AND PPS.PLAN_ID=CP.PLAN_ID
															) PP_CHK 
													ON PP_CHK.PROJECT_ID=PPR.PROJECT_ID
													WHERE PP_CHK.PROJECT_ID IS NULL
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PPP.FREQUENCY,RD.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
													RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,
													PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,
													PPP.CLUSTER_ID,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.PLAN_ID

													
									UNION 
													
													SELECT 
													PPS.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PPP.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, 
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													CASE WHEN CP.OUTPUT_TYPE=1 THEN SUM(PPS1.PLANNED_UNITS) ELSE SUM(PPS1.PLANNED_GRP) END UNITS,
													PPS1.START_DATE,
													PPS1.END_DATE,
													PPP.ON_MAP_START_DATE AS PROJ_START_DATE,
													PPP.ON_MAP_END_DATE AS PROJ_END_DATE,
													RCT.NAME CAMPAIGNTYPE,
													PPR.NAME PROJECT_NAME,
													'Y' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS1.PLANNED_GRP) AS PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM CTE_PAST_PLAN_ID PPS  
													JOIN CTE_PARAM CP ON 1=1
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN CTE_MODEL_TYPE CM ON 1=1
													JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PPS.PROJECT_ID AND PPR.PROJECT_TYPE=CT.PLAN_TYPE
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID 
													and PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID
													and M.MODEL_TYPE_ID=CM.MODEL_TYPE and M.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID and M.EXEC_STATUS_CD='C')
													and PPP.PLAN_ID<>CP.PLAN_ID
													JOIN REF_SEGMENT RS ON PPP.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON  PPP.ON_MAP_DEMO = RD.DEMO_ID 
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													LEFT JOIN PR_PLAN_SCHEDULE PPS1 ON PPS1.PLAN_ID = PPP.PLAN_ID
													AND PPS1.START_DATE BETWEEN CP.WEEK_START_DATE and  CP.WEEK_END_DATE
													AND PPS1.CAMPAIGN_GOAL_ID = PPP.CAMPAIGN_GOAL_ID
													AND PPS1.ACTIVE_YN = 'Y'
													AND PPS1.PLAN_VERSION_ID = 0
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PPP.FREQUENCY,RD.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
													RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,PPS1.START_DATE,PPS1.END_DATE,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,
													PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,
													PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.OUTPUT_TYPE,PPS.PLAN_ID
									)
									,CTE_PROJECT AS (
												SELECT DISTINCT PLAN_ID,PROJECT_ID FROM CTE_PLANNED_DATA
									)
									,CTE_PLAN_ENDDATE AS (
												SELECT CP.PROJECT_ID,MAX(ME.EXEC_END_DT) AS V_END_DT FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID 
												AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
												JOIN CTE_PROJECT CP ON 1=1
												WHERE PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
												GROUP BY CP.PROJECT_ID
									)
									,CTE_EPISODE_ENDDATE AS (
												SELECT CP.PROJECT_ID,MAX(ME.EXEC_END_DT) AS V_EPISODIC_END_DT FROM PR_PLAN_PROJECT_EPISODE PPP 
												INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
												JOIN CTE_PROJECT CP ON 1=1
												WHERE PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
												GROUP BY CP.PROJECT_ID
									)
									,CTE_VERSION AS (
												SELECT CP.PROJECT_ID,CONCAT('v', MAX(PPP.PLAN_VERSION_ID)+1,' ', TO_CHAR(MAX(ME.EXEC_END_DT), 'MM/DD/YYYY HH12:MI AM')) AS  
												V_GET_VERSION 
												FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
												JOIN CTE_PROJECT CP ON 1=1
												WHERE PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
												GROUP BY CP.PROJECT_ID
									)
									,CTE_VERSION_ID_DATE AS (
												SELECT CP.PROJECT_ID,CONCAT('v', MAX(PPP.PLAN_VERSION_ID)+1,' ', TO_CHAR(MAX(ME.EXEC_END_DT), 'MM/DD/YYYY HH12:MI AM'))       
												AS V_GET_VERSION 
												FROM PR_PLAN_PROJECT_EPISODE PPP 
												JOIN CTE_VERSION CV ON 1=1
												JOIN CTE_PLAN_ENDDATE CD ON 1=1
												JOIN CTE_EPISODE_ENDDATE CE ON 1=1
												JOIN CTE_PROJECT CP ON 1=1
												JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
												WHERE PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
												AND CV.V_GET_VERSION IS NULL OR CV.V_GET_VERSION = '' 
											-- OR CE.V_EPISODIC_END_DT > CD.V_END_DT
												GROUP BY CP.PROJECT_ID
									)
									,CTE_UPDATED_VERSION AS(
												SELECT * FROM CTE_VERSION
												UNION
												SELECT * FROM CTE_VERSION_ID_DATE
									)
									,CTE_FINAL AS(
												SELECT CD.* EXCLUDE(PLAN_ID), V_GET_VERSION LAST_OPT_VERSION_TS FROM CTE_PLANNED_DATA CD 
												JOIN CTE_UPDATED_VERSION CV ON CD.PROJECT_ID =CV.PROJECT_ID
									)
									SELECT * FROM CTE_FINAL;`,

		weeklyMapPlannedDataResult1: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											JOIN CTE_PARAM CP ON 1=1 WHERE RMD.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_WEEK_DATE AS(		
											SELECT START_DATE AS V_WEEK_START_DATE,END_DATE AS V_WEEK_END_DATE FROM REF_CAL_PERIOD RF
											JOIN CTE_PARAM CP ON 1=1
											where START_DATE>=CP.WEEK_START_DATE 
											and END_DATE<=CP.WEEK_END_DATE and PERIOD_TYPE_CD='D' LIMIT 7
									)
									,CTE_CAPACITY AS (
											SELECT CD.V_WEEK_START_DATE,SUM(CAPACITY_PER_HOUR) AS DAY FROM PR_PROMO_CAPACITY PPC
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND PERIOD_TYPE='D' AND START_DATE=CD.V_WEEK_START_DATE
											AND CT.PLAN_TYPE=1 AND CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
											
											UNION

											SELECT CD.V_WEEK_START_DATE,SUM(CAPACITY_PER_HOUR) AS DAY FROM PR_2E_CAPACITY PPC
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND PERIOD_TYPE='D' AND START_DATE=CD.V_WEEK_START_DATE
											AND CT.PLAN_TYPE<>1 AND CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
													
									)				
									,CTE_GRP AS (

											SELECT CD.V_WEEK_START_DATE,SUM(PPCG.GRP_CAPACITY) AS DAY FROM PR_PROMO_CAPACITY PPC INNER JOIN PR_PROMO_CAPACITY_GRP PPCG 
											ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID	
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_NETWORK_DEMO CND ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND CP.OUTPUT_TYPE<>1
											AND PPC.PERIOD_TYPE='D' AND PPCG.DEMO_ID=CND.NETWORK_DEMO 
											AND PPC.START_DATE=CD.V_WEEK_START_DATE AND CT.PLAN_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

											SELECT CD.V_WEEK_START_DATE,SUM(PPCG.GRP_CAPACITY)AS DAY FROM PR_2E_CAPACITY PPC INNER JOIN PR_2E_CAPACITY_GRP PPCG 
											ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID	
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_NETWORK_DEMO CND ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND CP.OUTPUT_TYPE<>1
											AND PPC.PERIOD_TYPE='D' AND PPCG.DEMO_ID=CND.NETWORK_DEMO 
											AND PPC.START_DATE=CD.V_WEEK_START_DATE AND CT.PLAN_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE
									)
									SELECT * FROM CTE_CAPACITY
									UNION  
									SELECT * FROM CTE_GRP
									ORDER BY V_WEEK_START_DATE;`,

		weeklyMapPlannedDataResult2: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	
									,CTE_FUTURE_ID AS(
											SELECT PR.PLAN_ID AS FUTURE_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											where PERIOD_ID=CF.FUTURE_PERIOD_ID and PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											and PR.PLAN_TYPE = CT.PLAN_TYPE LIMIT 1
									)
									,CTE_WEEK_DATE AS(		
											SELECT START_DATE AS V_WEEK_START_DATE,END_DATE AS V_WEEK_END_DATE FROM REF_CAL_PERIOD RF
											JOIN CTE_PARAM CP ON 1=1
											where START_DATE>=CP.WEEK_START_DATE 
											and END_DATE<=CP.WEEK_END_DATE and PERIOD_TYPE_CD='D' LIMIT 7
									)
									,CTE_FUTURE_CAPACITY AS(
											SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_UNITS),0) AS DAY FROM CTE_WEEK_DATE  CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

											SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_UNITS),0) AS DAY FROM CTE_WEEK_DATE  CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE_EPISODE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
									)
									,CTE_FUTURE_GRP AS(
										SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_GRP),0) AS DAY FROM CTE_WEEK_DATE CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

										SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_GRP),0) AS DAY FROM CTE_WEEK_DATE CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE_EPISODE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE
									)
									SELECT * FROM CTE_FUTURE_CAPACITY
									UNION 
									SELECT * FROM CTE_FUTURE_GRP
									ORDER BY V_WEEK_START_DATE;`,

		weeklyMapPlannedEpisodePastUnitsData: `
											-- 1. :IN_PLAN_ID
											-- 2. :IN_WEEK_START_DATE
											-- 3. :IN_WEEK_END_DATE
											-- 4. :IN_MEDIA_OUTLET_ID
											-- 5. :IN_OUTPUT_TYPE


											WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID
													AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
											)
											,RCP AS 
											(
												SELECT 	START_DATE, END_DATE FROM REF_CAL_PERIOD RCP
													WHERE START_DATE BETWEEN :IN_WEEK_START_DATE 
													AND :IN_WEEK_END_DATE
													AND RCP.PERIOD_TYPE_CD = 'D'
											) -- SELECT * FROM RCP;
											,PPS AS 
											(
												SELECT PPS.PROJECT_ID,
													PPS.EPISODE_ID,
													RCP.START_DATE AS WEEK_DATE,
													CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
													NULL as BROADCAST_DATE,
													NULL as AIR_TIME, 
													PPS.PLAN_ID
													FROM RCP
													LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPS 
													ON PPS.START_DATE BETWEEN RCP.START_DATE AND RCP.END_DATE
													AND PPS.MEDIA_OUTLET_ID =:IN_MEDIA_OUTLET_ID
													AND PPS.PLAN_VERSION_ID = 0
													JOIN PR_PLAN PP ON PP.PLAN_ID = PPS.PLAN_ID
													AND PP.PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
												GROUP BY PROJECT_ID, EPISODE_ID, RCP.START_DATE,PPS.PLAN_ID,BROADCAST_DATE,AIR_TIME
											) -- AND * FROM PPS;
											,PPE AS
											(
													
												SELECT
												PPS.PROJECT_ID,
												PPS.EPISODE_ID,
												PPS.WEEK_DATE,
												PPS.PLANNED_UNITS,
												TO_CHAR(PPE.EPISODE_START_TS,'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
												FROM PPS
												JOIN PR_PLAN_PROJECT_EPISODE PPE
														ON PPE.PROJECT_ID = PPS.PROJECT_ID
														AND PPE.EPISODE_ID = PPS.EPISODE_ID
														AND PPE.PLAN_ID = PPS.PLAN_ID
														WHERE PPE.PLAN_ID = :IN_PLAN_ID
														AND PPE.PLAN_VERSION_ID = (SELECT MAX(PLAN_VERSION_ID) FROM PR_PLAN_VERSION WHERE PLAN_ID = :IN_PLAN_ID)
											
												UNION
											
												SELECT
												PPS.PROJECT_ID,
												PPS.EPISODE_ID,
												PPS.WEEK_DATE,
												PPS.PLANNED_UNITS,
												TO_CHAR(PPE.EPISODE_START_TS,'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
												FROM PPS
												LEFT JOIN PR_PLAN_PROJECT_EPISODE PPE
												ON PPE.PROJECT_ID = PPS.PROJECT_ID
												AND PPE.EPISODE_ID = PPS.EPISODE_ID
												AND PPE.PLAN_ID = PPS.PLAN_ID
												WHERE PPE.PLAN_ID <> :IN_PLAN_ID
												AND PPE.PLAN_VERSION_ID = (SELECT IFNULL(MAX(PLAN_VERSION_ID), 0)
												FROM MODEL_EXEC M WHERE M.PLAN_ID=PPS.PLAN_ID 
												AND M.MODEL_TYPE_ID = (CASE WHEN (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) = 1 THEN 1 ELSE 3 END)
												AND M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												AND M.EXEC_STATUS_CD='C')
												
											)
											SELECT * FROM PPE
											GROUP BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE,PLANNED_UNITS,EPISODE_START_TS
											ORDER BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE;	`,

		weeklyMapPlannedEpisodeFutureUnitsData: `
											--1 :IN_PLAN_ID,
											--2 :IN_WEEK_START_DATE,
											--3 :IN_WEEK_END_DATE,
											--4 :IN_MEDIA_OUTLET_ID,
											--5 :IN_OUTPUT_TYPE
											WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
											)
											,CTE_FUTURE_PLAN AS (
													SELECT PLAN_ID,PERIOD_ID FROM PR_PLAN WHERE
													PERIOD_ID = (SELECT PERIOD_ID+1 FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID)
													AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
													AND PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
												) -- SELECT * FROM CTE_FUTURE_PLAN;
												,CTE_DAYS AS (
													SELECT START_DATE FROM REF_CAL_PERIOD RCP WHERE PERIOD_TYPE_CD='D'
													AND RCP.START_DATE >= :IN_WEEK_START_DATE
													AND RCP.END_DATE <= :IN_WEEK_END_DATE
												)-- SELECT * FROM CTE_DAYS;	
												SELECT CD.START_DATE,CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN IFNULL(SUM(PLANNED_UNITS),0) ELSE IFNULL(SUM(PLANNED_GRP),0) END UNITS
												FROM CTE_DAYS CD
												LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPSE ON CD.START_DATE = PPSE.START_DATE
												AND PPSE.PLAN_ID = (SELECT PLAN_ID FROM CTE_FUTURE_PLAN)
												AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
												GROUP BY CD.START_DATE
												ORDER BY CD.START_DATE;`,