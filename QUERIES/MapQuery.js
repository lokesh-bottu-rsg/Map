module.exports = {
	mapQuery: {

		planOptimization: `
							-- 1.IN_MEDIA_OUTLET_ID
							-- 2.IN_QTR
							-- 3.IN_PLAN_TYPE

							WITH CTE_PERIOD_ID AS (
							SELECT PERIOD_ID FROM REF_CAL_PERIOD RC
							WHERE NAME=:IN_QTR AND PERIOD_TYPE_CD='Q'
					)
					,CTE_PLAN AS (
							SELECT PPL.ID,IFNULL(PP.PLAN_ID,0) AS PLAN_ID, PP.NAME AS PLAN_NAME, PP.PERIOD_ID, RPS.PLAN_STATUS_ID, RPS.NAME AS PLAN_STATUS,
							PP.CREATE_DT, PP.UPDATE_DATE, PP.UPDATE_USER, IFNULL(SU.first_name,'0') FIRST_NAME, IFNULL(SU.last_name,'0') LAST_NAME, PP.COMMENTS AS STATUS_COMMENT,
							CASE WHEN FLAG ='Y' THEN PPL.LOCK_TIMESTAMP ELSE NULL END AS LOCKED_TS,
							CASE WHEN FLAG = 'Y' THEN CONCAT(u.first_name, ' ' ,u.last_name) ELSE NULL END AS LOCKED_BY,
							CASE WHEN FLAG = 'Y' THEN PPL.LOCK_USER ELSE NULL END AS LOCKED_BY_ID
							FROM PR_PLAN PP
							JOIN CTE_PERIOD_ID CI ON 1=1
							INNER JOIN REF_PLAN_STATUS RPS ON PP.PLAN_STATUS_ID=RPS.PLAN_STATUS_ID
							INNER JOIN REF_CAL_PERIOD RCP
								ON PP.PERIOD_ID=RCP.PERIOD_ID
								AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
								AND RCP.PERIOD_TYPE_CD='Q'
								AND RCP.NAME=:IN_QTR
								AND PP.PLAN_TYPE=:IN_PLAN_TYPE
							LEFT JOIN sec_user SU ON PP.UPDATE_USER=SU.USER_ID
							LEFT JOIN PR_ENTITY_LOCK_UNLOCK_HISTORY PPL ON PPL.ENTITY_ID = PP.PLAN_ID
							LEFT JOIN sec_user u ON PPL.LOCK_USER=u.user_id
							WHERE CI.PERIOD_ID>312
					UNION
							SELECT NULL AS ID,
							null AS PLAN_ID,
							null AS PLAN_NAME,
							null as PERIOD_ID,
							NUll as PLAN_STATUS_ID,
							null AS PLAN_STATUS,
							null as CREATE_DT,
							null as UPDATE_DATE,
							null as UPDATE_USER,
							null as FIRST_NAME,
							null as LAST_NAME,
							null as STATUS_COMMENT,
							null as LOCKED_TS,
							null as LOCKED_BY,
							null as LOCKED_BY_ID
							FROM CTE_PERIOD_ID WHERE PERIOD_ID<=312
					)
					SELECT * EXCLUDE(ID) FROM CTE_PLAN ORDER BY ID DESC LIMIT 1;`,

		quarterWeeks: `
						-- 1. :IN_QTR

						WITH CTE_PERIOD AS (
							SELECT PERIOD_ID FROM REF_CAL_PERIOD WHERE NAME = :IN_QTR AND PERIOD_TYPE_CD='Q')
						,CTE_NAMES AS (
							SELECT NAME FROM REF_CAL_PERIOD WHERE PERIOD_ID IN (
								SELECT PERIOD_ID FROM CTE_PERIOD
								UNION ALL 
								SELECT PERIOD_ID + 1 FROM CTE_PERIOD))
						SELECT * FROM REF_CAL_PERIOD WHERE NAME IN (
						SELECT * FROM CTE_NAMES) AND PERIOD_TYPE_CD = 'W' 
						ORDER BY END_DATE LIMIT 26;	`,

		quarterlyMapPlannedProjectsData: `
										-- 1.IN_PLAN_ID
										-- 2.IN_QTR
										-- 3.IN_MEDIA_OUTLET_ID
										-- 4.IN_OUTPUT_TYPE

										WITH CTE_PLAN_TYPE AS (
											
											SELECT PLAN_TYPE,PP.PLAN_ID,MAX(ME.PLAN_VERSION_ID) IN_PLAN_VERSION_ID,
											PP.PERIOD_ID,RCP.START_DATE V_QTR_START_DATE,RCP.END_DATE V_QTR_END_DATE FROM PR_PLAN PP
											INNER JOIN REF_CAL_PERIOD RCP ON RCP.PERIOD_ID = PP.PERIOD_ID AND PERIOD_TYPE_CD = 'Q'
											INNER JOIN MODEL_EXEC ME ON ME.PLAN_ID = PP.PLAN_ID AND ME.MEDIA_OUTLET_ID = PP.MEDIA_OUTLET_ID AND ME.EXEC_STATUS_CD='C'
											WHERE PP.PLAN_ID = :IN_PLAN_ID  -- PARAM1
											AND PP.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID   -- PARAM3
											GROUP BY PP.PLAN_ID,PLAN_TYPE,PP.PERIOD_ID,RCP.START_DATE,RCP.END_DATE
										) -- SELECT * FROM CTE_PLAN_TYPE;
										,CTE_PAST_PLAN AS ( 
											SELECT IFNULL(PP.PLAN_ID,0) PLAN_ID,MAX(PLAN_VERSION_ID) V_PAST_PLAN_VERSION_ID,
											PP.PERIOD_ID FROM PR_PLAN PP
												INNER JOIN MODEL_EXEC ME ON ME.PLAN_ID = PP.PLAN_ID AND EXEC_STATUS_CD = 'C'
												WHERE PERIOD_ID=(SELECT PP.PERIOD_ID - 1 FROM PR_PLAN PP WHERE PLAN_ID = :IN_PLAN_ID  -- PARAM1 
																AND PP.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID   -- PARAM3 
																AND PLAN_TYPE= (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)) 
												AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID   -- PARAM3 
												AND ACTIVE_YN='Y' 
												AND PLAN_TYPE=(SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
												GROUP BY PP.PLAN_ID,PP.PERIOD_ID
										) -- SELECT * FROM CTE_PAST_PLAN;
										, CTE_DEFAULT_DEMO AS (
											SELECT DEMO_ID FROM REF_MEDIA_OUTLET_DEMO WHERE MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID   -- PARAM3
											AND DEFAULT_YN = 'Y'
										)  -- SELECT * FROM CTE_DEFAULT_DEMO;
										,CTE_MAP_END_DATE AS(
											SELECT END_DATE V_MAP_END_DATE FROM REF_CAL_PERIOD 
											WHERE PERIOD_ID = (SELECT PERIOD_ID + 1 FROM CTE_PLAN_TYPE) AND PERIOD_TYPE_CD = 'Q'
										) -- SELECT * FROM CTE_MAP_END_DATE;
										,CTE_PAST_QTR_DATA AS (
											SELECT 		
													PPP.PLAN_ID,
													PPP.PLAN_VERSION_ID,
													PPP.PROJECT_ID,
													PPP.ON_MAP_PREMIER_DATE,
													1 AS EPISODE_ID,
													PPP.STATUS_CD,
													PPP.PROJ_GRP,
													PPP.PROJ_REACH_PERCENT,
													PPP.USER_COMMENT,
													PPP.NETWORK_TARGET_DEMO_ID,
													'Y' AS PAST_QTR_PROJECT_FLAG,
													PPP.DISPLAY_SEQ,
													PPP.PROJ_PRIORITY PRIORITY1,
													PPP.TARGET_REACH_PCT TARGET_REACH1,
													PPP.TARGET_GRP TARGET_GRP1,
													PPP.CLUSTER_ID, 
													-- PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													-- PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPP.ON_MAP_START_DATE,
													PPP.ON_MAP_END_DATE,
													PPP.PHASE_TYPE,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE,
													PPP.ON_MAP_DEMO AS DEMO_ID,
													PPP.SEGMENT,
													PPP.FREQUENCY,
													PPP.CAMPAIGN_GOAL_ID,
													'PAST LAUNCH' PHASE_DUR_TYPE
												FROM 
												(	SELECT DISTINCT PPS.PLAN_ID, PPS.PLAN_VERSION_ID, PPS.PROJECT_ID, PPS.ACTIVE_YN, 
														PPS.MEDIA_OUTLET_ID, PPS.CAMPAIGN_GOAL_ID
														FROM PR_PLAN_SCHEDULE PPS 
														JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and PPS.PLAN_VERSION_ID=0 
														AND P.MEDIA_OUTLET_ID= :IN_MEDIA_OUTLET_ID 
														AND P.PLAN_TYPE=(SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) and P.PERIOD_ID < (SELECT PERIOD_ID FROM CTE_PLAN_TYPE)
														AND PPS.START_DATE BETWEEN (SELECT V_QTR_START_DATE FROM CTE_PLAN_TYPE) 
														AND (SELECT V_QTR_END_DATE FROM CTE_PLAN_TYPE) 
														AND PPS.ACTIVE_YN='Y'
												) PPS   
												JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID 
												and PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID and M.MODEL_TYPE_ID=1 
												AND M.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID   -- PARAM3  
												AND M.EXEC_STATUS_CD='C')
												AND PPP.PLAN_ID<>:IN_PLAN_ID  -- PARAM1


												UNION

												SELECT 		
													PPP.PLAN_ID,
													PPP.PLAN_VERSION_ID,
													PPP.PROJECT_ID,
													PPP.ON_MAP_PREMIER_DATE,
													PPPE.EPISODE_ID AS EPISODE_ID,
													PPP.STATUS_CD,
													PPP.PROJ_GRP,
													PPP.PROJ_REACH_PERCENT,
													PPP.USER_COMMENT,
													PPP.NETWORK_TARGET_DEMO_ID,
													'Y' AS PAST_QTR_PROJECT_FLAG,
													PPP.DISPLAY_SEQ,
													PPP.PROJ_PRIORITY PRIORITY1,
													PPP.TARGET_REACH_PCT TARGET_REACH1,
													PPP.TARGET_GRP TARGET_GRP1,
													PPP.CLUSTER_ID, -- change 2.7.5 additional
													-- PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													-- PPP.PROJ_GRP PROJ_PLANNED_GRP, -- change 2.7.5 additional
													PPP.ON_MAP_START_DATE,
													PPP.ON_MAP_END_DATE,
													PPP.PHASE_TYPE,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE,
													PPP.ON_MAP_DEMO AS DEMO_ID,
													PPP.SEGMENT,
													PPP.FREQUENCY,
													PPP.CAMPAIGN_GOAL_ID,
													'PAST EP' PHASE_DUR_TYPE
												FROM 
												(	SELECT DISTINCT PPS.PLAN_ID, PPS.PLAN_VERSION_ID, PPS.PROJECT_ID, PPS.ACTIVE_YN, PPS.MEDIA_OUTLET_ID,
														PPS.CAMPAIGN_GOAL_ID
														FROM PR_PLAN_SCHEDULE_EPISODE PPS 
														JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and PPS.PLAN_VERSION_ID=0 
														AND P.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID   -- PARAM3  
														AND P.PLAN_TYPE= (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) and P.PERIOD_ID < (SELECT PERIOD_ID FROM CTE_PLAN_TYPE)
														AND PPS.START_DATE between (SELECT V_QTR_START_DATE FROM CTE_PLAN_TYPE) 
														AND (SELECT V_QTR_END_DATE FROM CTE_PLAN_TYPE)  AND PPS.ACTIVE_YN='Y'
												) PPS   
												JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID 
												and PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID and M.MODEL_TYPE_ID=1 
												AND M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID   -- PARAM3
												and M.EXEC_STATUS_CD='C')
												and PPP.PLAN_ID<>:IN_PLAN_ID  -- PARAM1
												INNER JOIN PR_PLAN_PROJECT_EPISODE PPPE
												ON PPP.PROJECT_ID=PPPE.PROJECT_ID AND PPP.PLAN_ID=PPPE.PLAN_ID AND PPP.PLAN_VERSION_ID=PPPE.PLAN_VERSION_ID
												WHERE NOT EXISTS 
												(
													SELECT 1 FROM PR_PLAN_SCHEDULE PPS1 
														JOIN PR_PLAN P on P.PLAN_ID=PPS1.PLAN_ID and PPS1.PLAN_VERSION_ID=0 
														AND P.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID   -- PARAM3 
														AND P.PLAN_TYPE=(SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) 
														AND P.PERIOD_ID < (SELECT PERIOD_ID FROM CTE_PLAN_TYPE)
														AND PPS1.START_DATE BETWEEN (SELECT V_QTR_START_DATE FROM CTE_PLAN_TYPE)
														AND (SELECT V_QTR_END_DATE FROM CTE_PLAN_TYPE) AND PPS1.ACTIVE_YN='Y'
														WHERE PPS1.PROJECT_ID=PPP.PROJECT_ID
												)
										
										) -- SELECT * FROM CTE_PAST_QTR_DATA;
										,CTE_CUR_QTR_DATA AS (
											SELECT 		
													PPP.PLAN_ID,
													PPP.PLAN_VERSION_ID,
													PPP.PROJECT_ID,
													PPP.ON_MAP_PREMIER_DATE,
													1 AS EPISODE_ID,
													PPP.STATUS_CD,
													PPP.PROJ_GRP,
													PPP.PROJ_REACH_PERCENT,
													PPP.USER_COMMENT,
													PPP.NETWORK_TARGET_DEMO_ID,
													'N' AS PAST_QTR_PROJECT_FLAG,
													PPP.DISPLAY_SEQ,
													PPP.PROJ_PRIORITY PRIORITY1,
													PPP.TARGET_REACH_PCT TARGET_REACH1,
													PPP.TARGET_GRP TARGET_GRP1,
													PPP.CLUSTER_ID, 
													-- PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													-- PPP.PROJ_GRP PROJ_PLANNED_GRP,
													PPP.ON_MAP_START_DATE,
													PPP.ON_MAP_END_DATE,
													PPP.PHASE_TYPE,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE,
													PPP.ON_MAP_DEMO AS DEMO_ID,
													PPP.SEGMENT,
													PPP.FREQUENCY,
													PPP.CAMPAIGN_GOAL_ID,
													'CUR LAUNCH' PHASE_DUR_TYPE
												FROM PR_PLAN_PROJECT PPP 
												WHERE PPP.PLAN_ID = :IN_PLAN_ID  -- PARAM1 
												AND PPP.PLAN_VERSION_ID = (SELECT IN_PLAN_VERSION_ID FROM CTE_PLAN_TYPE) 
												AND PPP.CAMPAIGN_GOAL_ID >0 AND PPP.STATUS_CD <> 2

											UNION

											SELECT 		
													PPP.PLAN_ID,
													PPP.PLAN_VERSION_ID,
													PPP.PROJECT_ID,
													PPP.ON_MAP_PREMIER_DATE,
													PPPE.EPISODE_ID AS EPISODE_ID,
													PPP.STATUS_CD,
													PPP.PROJ_GRP,
													PPP.PROJ_REACH_PERCENT,
													PPP.USER_COMMENT,
													PPP.NETWORK_TARGET_DEMO_ID,
													'N' AS PAST_QTR_PROJECT_FLAG,
													PPP.DISPLAY_SEQ,
													PPP.PROJ_PRIORITY PRIORITY1,
													PPP.TARGET_REACH_PCT TARGET_REACH1,
													PPP.TARGET_GRP TARGET_GRP1,
													PPP.CLUSTER_ID,
													-- PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													-- PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPP.ON_MAP_START_DATE,
													PPP.ON_MAP_END_DATE,
													PPP.PHASE_TYPE,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE,
													PPP.ON_MAP_DEMO AS DEMO_ID,
													PPP.SEGMENT,
													PPP.FREQUENCY,
													PPP.CAMPAIGN_GOAL_ID,
													'CUR EP' PHASE_DUR_TYPE
												FROM PR_PLAN_PROJECT PPP
												INNER JOIN PR_PLAN_PROJECT_EPISODE PPPE
												ON PPP.PROJECT_ID=PPPE.PROJECT_ID AND PPP.PLAN_ID=PPPE.PLAN_ID AND PPP.PLAN_VERSION_ID=PPPE.PLAN_VERSION_ID
												AND PPP.PLAN_ID = :IN_PLAN_ID  -- PARAM1  
												AND PPP.PLAN_VERSION_ID = (SELECT IN_PLAN_VERSION_ID FROM CTE_PLAN_TYPE)
												AND PPPE.CAMPAIGN_GOAL_ID>0 AND PPP.STATUS_CD <> 2
												WHERE NOT EXISTS 
												(
													SELECT 1 FROM PR_PLAN_PROJECT PPP1 
														WHERE PPP1.PLAN_ID = :IN_PLAN_ID  -- PARAM1 
														AND PPP1.PLAN_VERSION_ID = (SELECT IN_PLAN_VERSION_ID FROM CTE_PLAN_TYPE) 
														AND PPP.PROJECT_ID=PPP1.PROJECT_ID AND PPP1.CAMPAIGN_GOAL_ID>0 AND PPP1.STATUS_CD <> 2
												)
												
										)-- SELECT * FROM CTE_CUR_QTR_DATA;
										,CTE_PLAN_PROJECTS AS (
										SELECT PLAN_ID,PROJECT_ID FROM CTE_PAST_QTR_DATA
										UNION
										SELECT PLAN_ID,PROJECT_ID FROM CTE_CUR_QTR_DATA
									)
									,CTE_PLAN_ENDDATE AS (
										SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_END_DT FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID
										AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
										JOIN CTE_PLAN_PROJECTS CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
										GROUP BY CP.PROJECT_ID
									)
									,CTE_EPISODE_ENDDATE AS (
											SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_EPISODIC_END_DT FROM PR_PLAN_PROJECT_EPISODE PPP
											INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
											JOIN CTE_PLAN_PROJECTS CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
											GROUP BY CP.PROJECT_ID
									)
									,CTE_VERSION AS (
											SELECT P1.PROJECT_ID,
											CONCAT('v',COALESCE(P2.OPT_PLAN_VERSION_ID, P1.OPT_PLAN_VERSION_ID)+1,' ',TO_CHAR(COALESCE(P2.V_EPISODIC_END_DT,P1.V_END_DT),'MM/DD/YYYY HH12:MI AM')) LAST_OPT_VERSION_TS
											FROM CTE_PLAN_ENDDATE P1
											LEFT JOIN CTE_EPISODE_ENDDATE P2
												ON P1.PROJECT_ID = P2.PROJECT_ID
									)
										,PROJ_DTL AS (
											SELECT * FROM CTE_PAST_QTR_DATA
											UNION 
											SELECT * FROM CTE_CUR_QTR_DATA
										) 
										-- SELECT * FROM PROJ_DTL;

										SELECT 
											PROJ_DTL.PROJECT_ID PROJECT_ID,
											PPR.NAME PROJECT_NAME,
											PROJ_DTL.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, 
										
											PROJ_DTL.ON_MAP_START_DATE AS PROJ_START_DATE,
											PROJ_DTL.ON_MAP_END_DATE AS PROJ_END_DATE,
											RD.NAME DEMO,
											RD.DEMO_ID DEMO_ID,
											RCT.NAME TYPE,
											RS.SEGMENT_NAME AS SEGMENT,
											PROJ_DTL.PRIORITY1 PRIORITY,
											PROJ_DTL.FREQUENCY,
											PROJ_DTL.TARGET_REACH1 AS REACH,
											PROJ_DTL.TARGET_GRP1 AS GRP,
											PROJ_DTL.PROJ_REACH_PERCENT,
											RPS.NAME AS STATUS_CD,
											CEIL(CASE WHEN DATEDIFF(DAY,PROJ_DTL.ON_MAP_START_DATE,PROJ_DTL.ON_MAP_END_DATE)=0 THEN 1 
												ELSE DATEDIFF(DAY,PROJ_DTL.ON_MAP_START_DATE,PROJ_DTL.ON_MAP_END_DATE) END / 7) AS NO_OF_WEEKS,
											null CAMPAIGN_ID,
											W.START_DATE WEEK_START_DATE,
											CASE WHEN :IN_OUTPUT_TYPE = 1     --PARAM4 
												THEN SUM(PPS.PLANNED_UNITS)
													ELSE SUM(PPS.PLANNED_GRP)
											END AS PLANNED_UNITS,
											PPR.USER_COMMENT AS PROJECT_COMMENT,
											PROJ_DTL.PAST_QTR_PROJECT_FLAG AS PAST_PROJECT,
											RCT.DISPLAY_SEQ AS CAMPAIGN_DISPLAY_SEQ,
											PROJ_DTL.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
											CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID   -- PARAM3 
											THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
											SUM(PPS.PLANNED_GRP) PROJ_GRP,
											PPR.SCATTER_IMPS ,
											PPR.MEDIA_OUTLET_ID,
											RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
											PROJ_DTL.CLUSTER_ID, 
											RC.CLUSTER_NAME AS CLUSTER_NAME, 
											PROJ_DTL.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
											PROJ_DTL.PROJ_GRP PROJ_PLANNED_GRP,
											PPR.EVENT_TYPE_ID AS EVENT_ID,
											RET.EVENT_TYPE_NAME AS EVENT_NAME,
											PPR.SUBEVENT_ID ,
											RES.SUBEVENT_NAME,
											PROJ_DTL.PHASE_TYPE,
											RPT.DESCRIPTION AS PH_DESC,
											PROJ_DTL.EPISODE_PRIORITY,
											PROJ_DTL.NO_OF_EPISODE,
											PROJ_DTL.PLAN_ID,
											CV.LAST_OPT_VERSION_TS


										FROM PROJ_DTL 
										JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PROJ_DTL.PROJECT_ID 
											AND PPR.PROJECT_TYPE=(SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
										JOIN CTE_VERSION CV ON CV.PROJECT_ID =PPR.PROJECT_ID
										JOIN REF_SEGMENT RS ON PROJ_DTL.SEGMENT=RS.SEGMENT_ID
										JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
										JOIN REF_DEMO RD ON PROJ_DTL.DEMO_ID = RD.DEMO_ID 
										JOIN REF_CAL_PERIOD RCP ON RCP.NAME = :IN_QTR  -- PARAM2 
										AND RCP.PERIOD_TYPE_CD = 'Q'
										JOIN REF_CAL_PERIOD W ON W.PERIOD_TYPE_CD = 'W'
											AND W.START_DATE >= (SELECT V_QTR_START_DATE FROM CTE_PLAN_TYPE) 
											AND W.START_DATE<= (SELECT V_MAP_END_DATE FROM CTE_MAP_END_DATE)
										LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PROJ_DTL.PHASE_TYPE
										LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PROJ_DTL.STATUS_CD
										LEFT JOIN REF_CLUSTER RC on PROJ_DTL.CLUSTER_ID=RC.CLUSTER_ID	
										LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
										LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
										LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
										LEFT JOIN PR_PLAN_SCHEDULE PPS ON PPS.PLAN_ID = PROJ_DTL.PLAN_ID
													AND PPS.START_DATE BETWEEN W.START_DATE AND W.END_DATE
													AND PPS.CAMPAIGN_GOAL_ID = PROJ_DTL.CAMPAIGN_GOAL_ID
													AND PPS.ACTIVE_YN = 'Y' AND PPS.PLAN_VERSION_ID = 0

										GROUP BY 
										PROJ_DTL.PROJECT_ID,
												PPR.NAME,
												W.START_DATE,
												PROJ_DTL.ON_MAP_PREMIER_DATE, 
												PROJ_DTL.ON_MAP_START_DATE,
												PROJ_DTL.ON_MAP_END_DATE,
												RD.NAME,
												RD.DEMO_ID,
												RCT.NAME,
												RS.SEGMENT_NAME,
												PROJ_DTL.PRIORITY1,
												PROJ_DTL.FREQUENCY,
												PROJ_DTL.TARGET_REACH1,
												PROJ_DTL.TARGET_GRP1,
												PROJ_DTL.PROJ_REACH_PERCENT,
												RPS.NAME,
												NO_OF_WEEKS,
												CAMPAIGN_ID,
												PPR.USER_COMMENT,
												PROJ_DTL.PAST_QTR_PROJECT_FLAG,
												RCT.DISPLAY_SEQ,
												PROJ_DTL.DISPLAY_SEQ,
												NETWORK_DISPLAY_SEQ,
												PPR.SCATTER_IMPS ,
												PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME,
												PROJ_DTL.CLUSTER_ID, 
												RC.CLUSTER_NAME, 
												PROJ_DTL.PROJ_REACH_PERCENT,
												PROJ_DTL.PROJ_GRP,
												PPR.EVENT_TYPE_ID,
												RET.EVENT_TYPE_NAME,
												PPR.SUBEVENT_ID ,
												RES.SUBEVENT_NAME,
												PROJ_DTL.PHASE_TYPE,
												RPT.DESCRIPTION,
												PROJ_DTL.EPISODE_PRIORITY,
												PROJ_DTL.NO_OF_EPISODE,
												PROJ_DTL.PLAN_ID,
												CV.LAST_OPT_VERSION_TS
												ORDER BY PROJ_DTL.DISPLAY_SEQ , PPR.NAME , W.START_DATE , PAST_QTR_PROJECT_FLAG;`,

		quarterlyMapPlannedPastUnitsData: `
										-- 1.IN_PLAN_ID,
										-- 2.IN_QTR,
										-- 3.IN_MEDIA_OUTLET_ID,
										-- 4.IN_OUTPUT_TYPE

										WITH CTE_PLAN_TYPE AS (

											SELECT PLAN_TYPE,PERIOD_ID FROM PR_PLAN 
											WHERE PLAN_ID = :IN_PLAN_ID -- PARAM1
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
										)
										,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID FROM REF_MEDIA_OUTLET_DEMO 
											WHERE MEDIA_OUTLET_ID =:IN_MEDIA_OUTLET_ID -- PARAM3
											AND DEFAULT_YN = 'Y'
										) -- SELECT * FROM CTE_NETWORK_DEMO;
										,CTE_WEEKS AS (
										SELECT START_DATE V_START_DATE,END_DATE V_END_DATE FROM REF_CAL_PERIOD RCP 
										WHERE FISCAL_QTR IN (SELECT FISCAL_QTR FROM REF_CAL_PERIOD RC JOIN CTE_PLAN_TYPE CT 
										WHERE RC.PERIOD_ID IN (CT.PERIOD_ID,CT.PERIOD_ID+1)) AND PERIOD_TYPE_CD='W' ORDER BY END_DATE ASC
										) -- SELECT * FROM CTE_WEEKS;
										,CTE_SPOTS_GRP AS (
											-- PRIMARY, SPOTS
											SELECT V_START_DATE,SUM(CAPACITY_PER_HOUR) SPOTS FROM CTE_WEEKS CW
											LEFT JOIN PR_PROMO_CAPACITY PRC ON START_DATE BETWEEN CW.V_START_DATE AND CW.V_END_DATE 
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
											AND PERIOD_TYPE = 'D' 
											WHERE :IN_OUTPUT_TYPE =1 -- PARAM4  
											AND (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) =1
											GROUP BY V_START_DATE

											UNION
											-- PRIMARY GRP
											SELECT V_START_DATE,SUM(PPCG.GRP_CAPACITY) SPOTS FROM CTE_WEEKS CW
											LEFT JOIN PR_PROMO_CAPACITY PRC ON START_DATE BETWEEN CW.V_START_DATE AND CW.V_END_DATE AND PERIOD_TYPE = 'D' 
											LEFT JOIN PR_PROMO_CAPACITY_GRP PPCG ON PRC.CAPACITY_ID=PPCG.CAPACITY_ID 
											AND PPCG.DEMO_ID = (SELECT DEMO_ID FROM CTE_NETWORK_DEMO)
											AND PRC.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
											WHERE :IN_OUTPUT_TYPE  =2 -- PARAM4
											AND (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) =1
											GROUP BY V_START_DATE

											
										) SELECT *, ROW_NUMBER() OVER(ORDER BY V_START_DATE) WEEK_NO FROM CTE_SPOTS_GRP;`,

		quarterlyMapPlannedFutureUnitsData: `
										-- 1.IN_PLAN_ID,
										-- 2.IN_QTR,
										-- 3.IN_MEDIA_OUTLET_ID,
										-- 4.IN_OUTPUT_TYPE

										WITH CTE_PLAN_TYPE AS (
											SELECT PERIOD_ID FROM REF_CAL_PERIOD RCP
											WHERE PERIOD_TYPE_CD='Q' AND NAME = :IN_QTR -- PARAM2
										)--  SELECT * FROM CTE_PLAN_TYPE;
										,CTE_FUTURE_PLAN AS (
											SELECT PLAN_ID,PP.PERIOD_ID,PLAN_TYPE FROM PR_PLAN PP
											JOIN CTE_PLAN_TYPE CP 
											WHERE PP.PERIOD_ID = CP.PERIOD_ID+1 
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
											UNION 
											SELECT NULL AS PLAN_ID, NULL AS PERIOD_ID, NULL AS PLAN_TYPE LIMIT 1  -- NULL
										)  -- SELECT * FROM CTE_FUTURE_PLAN;
										,CTE_WEEKS AS (
										SELECT START_DATE V_START_DATE,END_DATE V_END_DATE FROM REF_CAL_PERIOD RCP 
										WHERE FISCAL_QTR IN (SELECT FISCAL_QTR FROM REF_CAL_PERIOD RC JOIN CTE_PLAN_TYPE CT WHERE RC.PERIOD_ID IN (CT.PERIOD_ID,CT.PERIOD_ID+1)) AND PERIOD_TYPE_CD='W' LIMIT 26
										)  -- SELECT * FROM CTE_WEEKS;
										,CTE_UNITS AS (
											SELECT V_START_DATE,IFNULL(CASE WHEN :IN_OUTPUT_TYPE =1 THEN 
											SUM(PLANNED_UNITS) ELSE SUM(PLANNED_GRP) END,0) UNITS 
											FROM CTE_WEEKS LEFT JOIN PR_PLAN_SCHEDULE PPS ON PPS.START_DATE 
											BETWEEN V_START_DATE AND V_END_DATE 
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
											AND PLAN_ID = (SELECT IFNULL(PLAN_ID,0) FROM CTE_FUTURE_PLAN)
											GROUP BY V_START_DATE
											
											UNION ALL
											
											SELECT V_START_DATE,IFNULL(CASE WHEN :IN_OUTPUT_TYPE =1 THEN 
											SUM(PLANNED_UNITS) ELSE SUM(PLANNED_GRP) END,0) UNITS
											FROM CTE_WEEKS LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPS ON PPS.START_DATE 
											BETWEEN V_START_DATE AND V_END_DATE 
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID -- PARAM3
											AND PLAN_ID = (SELECT IFNULL(PLAN_ID,0) FROM CTE_FUTURE_PLAN)
											GROUP BY V_START_DATE
										)
										SELECT V_START_DATE,SUM(UNITS) UNITS,ROW_NUMBER() OVER (ORDER BY V_START_DATE) WEEK_NO 
										FROM CTE_UNITS GROUP BY V_START_DATE;`,

		quarterlyMapPlannedEpisodesData: `
										-- 1. :IN_MEDIA_OUTLET_ID
										-- 2. :IN_QTR
										-- 3. :IN_PLAN_ID
										-- 4. :IN_OUTPUT_TYPE

										WITH CTE_PLAN_TYPE AS (
											SELECT PLAN_TYPE FROM PR_PLAN 
											WHERE PLAN_ID = :IN_PLAN_ID
											AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID LIMIT 1
										) -- SELECT * FROM CTE_PLAN_TYPE;
										, CTE_QTR AS (
											SELECT NAME,FISCAL_QTR,START_DATE, END_DATE, PERIOD_ID 
											FROM REF_CAL_PERIOD WHERE NAME = :IN_QTR 
											AND PERIOD_TYPE_CD = 'Q' LIMIT 1
										)-- SELECT * fROM CTE_QTR;
										,CTE_MAP_END_DATE AS (
											SELECT END_DATE FROM REF_CAL_PERIOD 
											WHERE NAME = (SELECT FISCAL_QTR FROM CTE_QTR) AND PERIOD_TYPE_CD = 'Q'
										)--  SELECT * FROM CTE_MAP_END_DATE;
										,RCP AS 
										(
											SELECT 	START_DATE, END_DATE FROM REF_CAL_PERIOD RCP
											WHERE START_DATE BETWEEN (SELECT START_DATE FROM CTE_QTR)
											AND (SELECT END_DATE FROM CTE_MAP_END_DATE)
											AND RCP.PERIOD_TYPE_CD = 'W'
										)
										,PPS AS 
										(
											SELECT PPS.PROJECT_ID,
											PPS.EPISODE_ID,
											RCP.START_DATE AS WEEK_DATE,
											CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
											-- SUM(PPS.PLANNED_UNITS) PLANNED_UNITS,
											PPS.PLAN_ID
											FROM RCP
											LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPS 
											ON PPS.START_DATE BETWEEN RCP.START_DATE AND RCP.END_DATE
											AND PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
											AND PPS.PLAN_VERSION_ID = 0
											JOIN PR_PLAN PP ON PP.PLAN_ID = PPS.PLAN_ID
											AND PP.PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) 
											GROUP BY PROJECT_ID, EPISODE_ID, RCP.START_DATE,PPS.PLAN_ID
										)

										,PPE AS
										(       
											SELECT
											PPS.PROJECT_ID,
											PPS.EPISODE_ID,
											PPS.WEEK_DATE,
											PPS.PLANNED_UNITS,
											TO_CHAR(PPE.EPISODE_START_TS,'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
											FROM PPS
											JOIN PR_PLAN_PROJECT_EPISODE PPE
													ON PPE.PROJECT_ID = PPS.PROJECT_ID
													AND PPE.EPISODE_ID = PPS.EPISODE_ID
													AND PPE.PLAN_ID = PPS.PLAN_ID
													WHERE PPE.PLAN_ID = :IN_PLAN_ID
													AND PPE.PLAN_VERSION_ID = (SELECT MAX(PLAN_VERSION_ID) FROM PR_PLAN_VERSION WHERE PLAN_ID = :IN_PLAN_ID)
										
											UNION
										
											SELECT
											PPS.PROJECT_ID,
											PPS.EPISODE_ID,
											PPS.WEEK_DATE,
											PPS.PLANNED_UNITS,
											TO_CHAR(PPE.EPISODE_START_TS, 'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
											FROM PPS
											LEFT JOIN PR_PLAN_PROJECT_EPISODE PPE
											ON PPE.PROJECT_ID = PPS.PROJECT_ID
											AND PPE.EPISODE_ID = PPS.EPISODE_ID
											AND PPE.PLAN_ID = PPS.PLAN_ID
											WHERE PPE.PLAN_ID <> :IN_PLAN_ID
											AND PPE.PLAN_VERSION_ID = (SELECT IFNULL(MAX(PLAN_VERSION_ID), 0)
											FROM MODEL_EXEC M where M.PLAN_ID=PPS.PLAN_ID 
											and M.MODEL_TYPE_ID= (CASE WHEN (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) = 1 THEN 1 ELSE 3 END)
											and M.MEDIA_OUTLET_ID= :IN_MEDIA_OUTLET_ID
											and M.EXEC_STATUS_CD='C')
										)
										SELECT * FROM PPE
										GROUP BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE,PPE.PLANNED_UNITS,EPISODE_START_TS
										ORDER BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE;`,

		weeklyMapPlannedProjectsData: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_MODEL_TYPE AS(
											select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
											FROM CTE_PLAN_TYPE
									)
									,CTE_PAST_PLAN  AS (
											SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PLAN_TYPE CP ON 1=1
											WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
											JOIN CTE_PLAN_TYPE CP ON 1=1 
											WHERE PP.PLAN_ID=CP.PLAN_ID AND PP.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
											AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
									)
									,CTE_VERSION_ID AS(
											SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
											JOIN CTE_PARAM CP ON 1=1
											WHERE MD.PLAN_ID=CP.PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											JOIN CTE_PARAM CP ON 1=1 WHERE RMD.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	  
									,CTE_FUTURE_ENDDATE AS (
											select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
											JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
									)
									,CTE_FUTURE_ID AS(
											SELECT PR.PLAN_ID AS FUTURE_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											where PERIOD_ID=CF.FUTURE_PERIOD_ID and PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											and PR.PLAN_TYPE = CT.PLAN_TYPE LIMIT 1
									)
									,CTE_MAP_END_DATE AS (    
											select END_DATE AS V_MAP_END_DATE 
											from REF_CAL_PERIOD RF
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											where PERIOD_ID= CF.FUTURE_PERIOD_ID
									)
									,CTE_PAST_PLAN_ID AS(
											SELECT DISTINCT PPS.PLAN_ID, PPS.PLAN_VERSION_ID, PPS.PROJECT_ID, PPS.ACTIVE_YN, PPS.MEDIA_OUTLET_ID, 
											PPS.CAMPAIGN_GOAL_ID CAMPAIGN_GOAL_ID, 'N' AS IS_EPISODIC 
											FROM PR_PLAN_SCHEDULE PPS 
											JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and PPS.PLAN_VERSION_ID=0 and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											AND P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
											AND PPS.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPS.ACTIVE_YN='Y'
											
											UNION
											
											SELECT DISTINCT PPSE.PLAN_ID, PPSE.PLAN_VERSION_ID, PPSE.PROJECT_ID, PPSE.ACTIVE_YN, PPSE.MEDIA_OUTLET_ID,
											PPSE.CAMPAIGN_GOAL_ID CAMPAIGN_GOAL_ID, 'Y' AS IS_EPISODIC
											FROM PR_PLAN_SCHEDULE_EPISODE PPSE 
											JOIN PR_PLAN P on P.PLAN_ID=PPSE.PLAN_ID and PPSE.PLAN_VERSION_ID=0 
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											WHERE P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											AND PPSE.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPSE.ACTIVE_YN='Y'
											AND not exists
											(
											SELECT 1 FROM PR_PLAN_SCHEDULE PPS1
											JOIN CTE_PARAM CP ON PPS1.PLAN_ID=CP.PLAN_ID
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PERIOD_ID CI ON 1=1
											JOIN PR_PLAN P on P.PLAN_ID=PPS1.PLAN_ID and PPS1.PLAN_VERSION_ID=0 and P.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
											AND PPS1.START_DATE between CP.WEEK_START_DATE and  CP.WEEK_END_DATE AND PPS1.ACTIVE_YN='Y'
											WHERE PPSE.PROJECT_ID=PPS1.PROJECT_ID
											)
									)
									,CTE_PLANNED_DATA AS (  
													SELECT 
													CP.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PCG.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													CASE WHEN CP.OUTPUT_TYPE=1 THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END UNITS,
													PPS.START_DATE,
													PPS.END_DATE,
													PCG.START_DATE AS PROJ_START_DATE,
													PCG.END_DATE AS PROJ_END_DATE,
													RCT.NAME TYPE,
													PPR.NAME PROJECT_NAME,
													'N' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS.PLANNED_GRP) PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP,
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM 
													PR_PLAN_SCHEDULE PPS 
													JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
													JOIN CTE_VERSION_ID CV ON 1=1
													JOIN PR_PROJECT PPR ON PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE
													AND PPR.PROJECT_ID = PPS.PROJECT_ID 
													AND PPS.ACTIVE_YN='Y'
													and PPS.PLAN_ID=CP.PLAN_ID
													JOIN PR_CAMPAIGN_GOAL PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID
													AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
													AND PPS.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
													JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
													AND PPP.PROJECT_ID=PPS.PROJECT_ID
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN  REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		-- change 2.7.5 additional
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PCG.FREQUENCY,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,				                    RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,CP.OUTPUT_TYPE,PPS.START_DATE,PPS.END_DATE,PCG.START_DATE,PCG.END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,
													PPP.DISPLAY_SEQ,PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,RD.NAME,        
													PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,
													PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,PPP.PHASE_TYPE,RPT.DESCRIPTION ,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.PLAN_ID


									UNION
														
													SELECT 
													CP.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PPP.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													0 UNITS,
													MIN(PPS.START_DATE) AS START_DATE,
													MIN(PPS.END_DATE) AS END_DATE,
													PPP.ON_MAP_START_DATE AS PROJ_START_DATE,
													PPP.ON_MAP_END_DATE AS PROJ_END_DATE,
													RCT.NAME TYPE,
													PPR.NAME PROJECT_NAME,
													'N' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													0 PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													MAX(RC.CLUSTER_NAME) AS CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM 
													PR_PLAN_SCHEDULE_EPISODE PPS 
													JOIN CTE_PARAM CP ON PPS.PLAN_ID=CP.PLAN_ID
													JOIN CTE_VERSION_ID CV ON 1=1
													JOIN PR_PROJECT PPR ON PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE
													AND PPR.PROJECT_ID = PPS.PROJECT_ID  
													AND PPS.ACTIVE_YN='Y'
													and PPS.PLAN_ID=CP.PLAN_ID 
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
													AND PPP.PROJECT_ID=PPS.PROJECT_ID 
													AND PPS.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON PPP.ON_MAP_DEMO = RD.DEMO_ID
													JOIN REF_SEGMENT RS ON PPP.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN  REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													LEFT JOIN (SELECT DISTINCT PROJECT_ID FROM PR_PLAN_SCHEDULE PPS 
															JOIN CTE_PARAM CP ON 1=1
															WHERE PPS.START_DATE BETWEEN CP.WEEK_START_DATE AND CP.WEEK_END_DATE AND PPS.PLAN_ID=CP.PLAN_ID
															) PP_CHK 
													ON PP_CHK.PROJECT_ID=PPR.PROJECT_ID
													WHERE PP_CHK.PROJECT_ID IS NULL
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PPP.FREQUENCY,RD.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
													RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,
													PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,
													PPP.CLUSTER_ID,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.PLAN_ID

													
									UNION 
													
													SELECT 
													PPS.PLAN_ID,
													PPR.PROJECT_ID,
													1 as EPISODE_ID,
													PPR.NAME CAMPAIGN,
													NULL CAMPAIGN_ID,
													PPP.FREQUENCY,
													RD.NAME AS DEMO,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE)=0 then 1 
													else DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
													RPS.NAME AS STATUS_CD,
													PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, 
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													CASE WHEN CP.OUTPUT_TYPE=1 THEN SUM(PPS1.PLANNED_UNITS) ELSE SUM(PPS1.PLANNED_GRP) END UNITS,
													PPS1.START_DATE,
													PPS1.END_DATE,
													PPP.ON_MAP_START_DATE AS PROJ_START_DATE,
													PPP.ON_MAP_END_DATE AS PROJ_END_DATE,
													RCT.NAME CAMPAIGNTYPE,
													PPR.NAME PROJECT_NAME,
													'Y' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
													PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS1.PLANNED_GRP) AS PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,                    
													PPP.TARGET_REACH_PCT TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME, 
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP, 
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,
													RPT.DESCRIPTION PH_DESC,
													CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
													PPP.NO_OF_EPISODE
													FROM CTE_PAST_PLAN_ID PPS  
													JOIN CTE_PARAM CP ON 1=1
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN CTE_MODEL_TYPE CM ON 1=1
													JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PPS.PROJECT_ID AND PPR.PROJECT_TYPE=CT.PLAN_TYPE
													JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID 
													and PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID
													and M.MODEL_TYPE_ID=CM.MODEL_TYPE and M.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID and M.EXEC_STATUS_CD='C')
													and PPP.PLAN_ID<>CP.PLAN_ID
													JOIN REF_SEGMENT RS ON PPP.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON  PPP.ON_MAP_DEMO = RD.DEMO_ID 
													LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
													LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													LEFT JOIN PR_PLAN_SCHEDULE PPS1 ON PPS1.PLAN_ID = PPP.PLAN_ID
													AND PPS1.START_DATE BETWEEN CP.WEEK_START_DATE and  CP.WEEK_END_DATE
													AND PPS1.CAMPAIGN_GOAL_ID = PPP.CAMPAIGN_GOAL_ID
													AND PPS1.ACTIVE_YN = 'Y'
													AND PPS1.PLAN_VERSION_ID = 0
													GROUP BY PPR.PROJECT_ID,PPR.NAME,PPP.FREQUENCY,RD.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
													RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,PPS1.START_DATE,PPS1.END_DATE,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE,RCT.NAME,PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,
													PPR.MEDIA_OUTLET_ID,CP.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,
													PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,
													PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE,CP.OUTPUT_TYPE,PPS.PLAN_ID
									)
									,CTE_PROJECT AS (
												SELECT DISTINCT PLAN_ID,PROJECT_ID FROM CTE_PLANNED_DATA
									)
									,CTE_PLAN_ENDDATE AS (
										SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_END_DT FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID
										AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
										JOIN CTE_PROJECT CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
										GROUP BY CP.PROJECT_ID
									)
									,CTE_EPISODE_ENDDATE AS (
											SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_EPISODIC_END_DT FROM PR_PLAN_PROJECT_EPISODE PPP
											INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
											JOIN CTE_PROJECT CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
											GROUP BY CP.PROJECT_ID
									)
									,CTE_UPDATED_VERSION AS (
											SELECT P1.PROJECT_ID,
											CONCAT('v',COALESCE(P2.OPT_PLAN_VERSION_ID, P1.OPT_PLAN_VERSION_ID)+1,' ',TO_CHAR(COALESCE(P2.V_EPISODIC_END_DT,P1.V_END_DT),'MM/DD/YYYY HH12:MI AM')) V_GET_VERSION
											FROM CTE_PLAN_ENDDATE P1
											LEFT JOIN CTE_EPISODE_ENDDATE P2
												ON P1.PROJECT_ID = P2.PROJECT_ID
									)
									,CTE_FINAL AS(
												SELECT CD.* EXCLUDE(PLAN_ID), V_GET_VERSION LAST_OPT_VERSION_TS FROM CTE_PLANNED_DATA CD 
												JOIN CTE_UPDATED_VERSION CV ON CD.PROJECT_ID =CV.PROJECT_ID
									)
									SELECT * FROM CTE_FINAL
									ORDER BY PROJECT_DISPLAY_SEQ  , PROJECT_NAME;`,

		weeklyMapPlannedDataResult1: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											JOIN CTE_PARAM CP ON 1=1 WHERE RMD.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_WEEK_DATE AS(		
											SELECT START_DATE AS V_WEEK_START_DATE,END_DATE AS V_WEEK_END_DATE FROM REF_CAL_PERIOD RF
											JOIN CTE_PARAM CP ON 1=1
											where START_DATE>=CP.WEEK_START_DATE 
											and END_DATE<=CP.WEEK_END_DATE and PERIOD_TYPE_CD='D' LIMIT 7
									)
									,CTE_CAPACITY AS (
											SELECT CD.V_WEEK_START_DATE,SUM(CAPACITY_PER_HOUR) AS DAY FROM PR_PROMO_CAPACITY PPC
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND PERIOD_TYPE='D' AND START_DATE=CD.V_WEEK_START_DATE
											AND CT.PLAN_TYPE=1 AND CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
											
											UNION

											SELECT CD.V_WEEK_START_DATE,SUM(CAPACITY_PER_HOUR) AS DAY FROM PR_2E_CAPACITY PPC
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID
											AND PERIOD_TYPE='D' AND START_DATE=CD.V_WEEK_START_DATE
											AND CT.PLAN_TYPE<>1 AND CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
													
									)				
									,CTE_GRP AS (

											SELECT CD.V_WEEK_START_DATE,SUM(PPCG.GRP_CAPACITY) AS DAY FROM PR_PROMO_CAPACITY PPC INNER JOIN PR_PROMO_CAPACITY_GRP PPCG 
											ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID	
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_NETWORK_DEMO CND ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND CP.OUTPUT_TYPE<>1
											AND PPC.PERIOD_TYPE='D' AND PPCG.DEMO_ID=CND.NETWORK_DEMO 
											AND PPC.START_DATE=CD.V_WEEK_START_DATE AND CT.PLAN_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

											SELECT CD.V_WEEK_START_DATE,SUM(PPCG.GRP_CAPACITY)AS DAY FROM PR_2E_CAPACITY PPC INNER JOIN PR_2E_CAPACITY_GRP PPCG 
											ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID	
											JOIN CTE_PLAN_TYPE CT ON 1=1
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_NETWORK_DEMO CND ON 1=1
											LEFT join CTE_WEEK_DATE CD ON 1=1
											WHERE PPC.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID AND CP.OUTPUT_TYPE<>1
											AND PPC.PERIOD_TYPE='D' AND PPCG.DEMO_ID=CND.NETWORK_DEMO 
											AND PPC.START_DATE=CD.V_WEEK_START_DATE AND CT.PLAN_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE
									)
									SELECT * FROM CTE_CAPACITY
									UNION  
									SELECT * FROM CTE_GRP
									ORDER BY V_WEEK_START_DATE;`,

		weeklyMapPlannedDataResult2: `
									WITH CTE_PARAM AS (
											SELECT :IN_PLAN_ID AS PLAN_ID,
											:IN_WEEK_START_DATE as WEEK_START_DATE,
											:IN_WEEK_END_DATE AS WEEK_END_DATE,
											-- :IN_PLAN_VERISON_ID AS PLAN_VERISON_ID,
											:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID,
											:IN_OUTPUT_TYPE AS OUTPUT_TYPE
									)
									,CTE_PLAN_TYPE AS (
											SELECT CP.*,PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID  AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											WHERE PR.PLAN_ID=CP.PLAN_ID AND PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	
									,CTE_FUTURE_ID AS(
											SELECT PR.PLAN_ID AS FUTURE_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PARAM CP ON 1=1
											JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
											JOIN CTE_PLAN_TYPE CT ON 1=1
											where PERIOD_ID=CF.FUTURE_PERIOD_ID and PR.MEDIA_OUTLET_ID=CP.MEDIA_OUTLET_ID 
											and PR.PLAN_TYPE = CT.PLAN_TYPE LIMIT 1
									)
									,CTE_WEEK_DATE AS(		
											SELECT START_DATE AS V_WEEK_START_DATE,END_DATE AS V_WEEK_END_DATE FROM REF_CAL_PERIOD RF
											JOIN CTE_PARAM CP ON 1=1
											where START_DATE>=CP.WEEK_START_DATE 
											and END_DATE<=CP.WEEK_END_DATE and PERIOD_TYPE_CD='D' LIMIT 7
									)
									,CTE_FUTURE_CAPACITY AS(
											SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_UNITS),0) AS DAY FROM CTE_WEEK_DATE  CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

											SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_UNITS),0) AS DAY FROM CTE_WEEK_DATE  CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE_EPISODE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE=1
											GROUP BY CD.V_WEEK_START_DATE
									)
									,CTE_FUTURE_GRP AS(
										SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_GRP),0) AS DAY FROM CTE_WEEK_DATE CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE

											UNION 

										SELECT CD.V_WEEK_START_DATE,ifnull(SUM(PLANNED_GRP),0) AS DAY FROM CTE_WEEK_DATE CD
											LEFT JOIN CTE_PARAM CP ON 1=1
											LEFT JOIN CTE_FUTURE_ID CF ON 1=1
											LEFT join PR_PLAN_SCHEDULE_EPISODE PPS ON PPS.START_DATE BETWEEN CD.V_WEEK_START_DATE AND CD.V_WEEK_END_DATE
											AND PPS.MEDIA_OUTLET_ID =CP.MEDIA_OUTLET_ID AND PPS.PLAN_ID=ifnull(CF.FUTURE_PLAN_ID,0)
											WHERE CP.OUTPUT_TYPE<>1
											GROUP BY CD.V_WEEK_START_DATE
									)
									SELECT * FROM CTE_FUTURE_CAPACITY
									UNION 
									SELECT * FROM CTE_FUTURE_GRP
									ORDER BY V_WEEK_START_DATE;`,

		weeklyMapPlannedEpisodePastUnitsData: `
											-- 1. :IN_PLAN_ID
											-- 2. :IN_WEEK_START_DATE
											-- 3. :IN_WEEK_END_DATE
											-- 4. :IN_MEDIA_OUTLET_ID
											-- 5. :IN_OUTPUT_TYPE


											WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID
													AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
											)
											,RCP AS 
											(
												SELECT 	START_DATE, END_DATE FROM REF_CAL_PERIOD RCP
													WHERE START_DATE BETWEEN :IN_WEEK_START_DATE 
													AND :IN_WEEK_END_DATE
													AND RCP.PERIOD_TYPE_CD = 'D'
											) -- SELECT * FROM RCP;
											,PPS AS 
											(
												SELECT PPS.PROJECT_ID,
													PPS.EPISODE_ID,
													RCP.START_DATE AS WEEK_DATE,
													CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
													NULL as BROADCAST_DATE,
													NULL as AIR_TIME, 
													PPS.PLAN_ID
													FROM RCP
													LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPS 
													ON PPS.START_DATE BETWEEN RCP.START_DATE AND RCP.END_DATE
													AND PPS.MEDIA_OUTLET_ID =:IN_MEDIA_OUTLET_ID
													AND PPS.PLAN_VERSION_ID = 0
													JOIN PR_PLAN PP ON PP.PLAN_ID = PPS.PLAN_ID
													AND PP.PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
												GROUP BY PROJECT_ID, EPISODE_ID, RCP.START_DATE,PPS.PLAN_ID,BROADCAST_DATE,AIR_TIME
											) -- AND * FROM PPS;
											,PPE AS
											(
													
												SELECT
												PPS.PROJECT_ID,
												PPS.EPISODE_ID,
												PPS.WEEK_DATE,
												PPS.PLANNED_UNITS,
												TO_CHAR(PPE.EPISODE_START_TS,'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
												FROM PPS
												JOIN PR_PLAN_PROJECT_EPISODE PPE
														ON PPE.PROJECT_ID = PPS.PROJECT_ID
														AND PPE.EPISODE_ID = PPS.EPISODE_ID
														AND PPE.PLAN_ID = PPS.PLAN_ID
														WHERE PPE.PLAN_ID = :IN_PLAN_ID
														AND PPE.PLAN_VERSION_ID = (SELECT MAX(PLAN_VERSION_ID) FROM PR_PLAN_VERSION WHERE PLAN_ID = :IN_PLAN_ID)
											
												UNION
											
												SELECT
												PPS.PROJECT_ID,
												PPS.EPISODE_ID,
												PPS.WEEK_DATE,
												PPS.PLANNED_UNITS,
												TO_CHAR(PPE.EPISODE_START_TS,'MM/DD/YYYY HH12:MI:SS AM') EPISODE_START_TS
												FROM PPS
												LEFT JOIN PR_PLAN_PROJECT_EPISODE PPE
												ON PPE.PROJECT_ID = PPS.PROJECT_ID
												AND PPE.EPISODE_ID = PPS.EPISODE_ID
												AND PPE.PLAN_ID = PPS.PLAN_ID
												WHERE PPE.PLAN_ID <> :IN_PLAN_ID
												AND PPE.PLAN_VERSION_ID = (SELECT IFNULL(MAX(PLAN_VERSION_ID), 0)
												FROM MODEL_EXEC M WHERE M.PLAN_ID=PPS.PLAN_ID 
												AND M.MODEL_TYPE_ID = (CASE WHEN (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) = 1 THEN 1 ELSE 3 END)
												AND M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												AND M.EXEC_STATUS_CD='C')
												
											)
											SELECT * FROM PPE
											GROUP BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE,PLANNED_UNITS,EPISODE_START_TS
											ORDER BY PPE.PROJECT_ID , PPE.EPISODE_ID,PPE.WEEK_DATE;	`,

		weeklyMapPlannedEpisodeFutureUnitsData: `
											--1 :IN_PLAN_ID,
											--2 :IN_WEEK_START_DATE,
											--3 :IN_WEEK_END_DATE,
											--4 :IN_MEDIA_OUTLET_ID,
											--5 :IN_OUTPUT_TYPE
											WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
											)
											,CTE_FUTURE_PLAN AS (
													SELECT PLAN_ID,PERIOD_ID FROM PR_PLAN WHERE
													PERIOD_ID = (SELECT PERIOD_ID+1 FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID)
													AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
													AND PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
												) -- SELECT * FROM CTE_FUTURE_PLAN;
												,CTE_DAYS AS (
													SELECT START_DATE FROM REF_CAL_PERIOD RCP WHERE PERIOD_TYPE_CD='D'
													AND RCP.START_DATE >= :IN_WEEK_START_DATE
													AND RCP.END_DATE <= :IN_WEEK_END_DATE
												)-- SELECT * FROM CTE_DAYS;	
												SELECT CD.START_DATE,CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN IFNULL(SUM(PLANNED_UNITS),0) ELSE IFNULL(SUM(PLANNED_GRP),0) END UNITS
												FROM CTE_DAYS CD
												LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPSE ON CD.START_DATE = PPSE.START_DATE
												AND PPSE.PLAN_ID = (SELECT PLAN_ID FROM CTE_FUTURE_PLAN)
												AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
												GROUP BY CD.START_DATE
												ORDER BY CD.START_DATE;`,

		dailyMapPlannedDataResult1A: `
		                            -- (PLAN_ID=0)
		                            -- :IN_PLAN_ID
									-- :IN_MEDIA_OUTLET_ID
									-- :IN_OUTPUT_TYPE
									-- :IN_WEEK_DATE

									WITH CTE_PLAN_TYPE AS (
											SELECT PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID  AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_MODEL_TYPE AS(
											select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
											FROM CTE_PLAN_TYPE
									)
									,CTE_PAST_PLAN  AS (
											SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PLAN_TYPE CP ON 1=1
											WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
											JOIN CTE_PLAN_TYPE CP ON 1=1 
											WHERE PP.PLAN_ID=:IN_PLAN_ID AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
											AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
									)
									,CTE_VERSION_ID AS(
											SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
											WHERE MD.PLAN_ID=:IN_PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											WHERE RMD.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	  
									,CTE_FUTURE_ENDDATE AS (
											select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
											JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
									)
									,CTE_PRIMARY_PLAN AS(
											SELECT 
											PP.PLAN_ID,
											PC.NAME CAMPAIGN,
											PC.CAMPAIGN_ID,
											PC.PROJECT_ID,
											RCT.NAME AS TYPE,
											PCG.FREQUENCY,
											RD.NAME AS DEMO,
											PPP.PROJ_REACH_PERCENT,
											CEIL(CASE WHEN DATEDIFF('day', PPP.ON_MAP_START_DATE, PPP.ON_MAP_END_DATE) = 0 
												THEN 1 
											ELSE DATEDIFF('day', PPP.ON_MAP_START_DATE, PPP.ON_MAP_END_DATE) / 7.0 END) AS no_of_weeks,
											PPP.STATUS_CD,
											PPR.PREMIERE_DATE,
											RS.SEGMENT_NAME SEGMENT,
											PPP.PROJ_PRIORITY PRIORITY,
											RDT.DAYPART_ID,
											RDT.NAME DAYPART,
											RD.NAME DEMO,
											CASE WHEN :IN_OUTPUT_TYPE=1 THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
											PP.NAME PLAN_NAME,
											PP.CREATE_DT,
											PPS.START_DATE AS SELECTED_DATE,
											PCG.START_DATE AS PROJ_START_DATE,
											PCG.END_DATE AS PROJ_END_DATE,
											PPR.NAME PROJECT_NAME,
											SUM(PPS.PLANNED_GRP) PROJ_GRP,
											SUM(PPS.PLANNED_GRP) * GET_NAT_UNIVERSE(CD.NETWORK_DEMO)/100000 SCATTER_IMPS,
											PPP.TARGET_REACH_PCT TARGET_REACH,
											PPP.TARGET_GRP TARGET_GRP,
											PPP.CLUSTER_ID, 
											case when PPP.CLUSTER_ID is null then null else MAX(RC.CLUSTER_NAME) end CLUSTER_NAME, 
											PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH, 
											PPP.PROJ_GRP PROJ_PLANNED_GRP
											FROM
											PR_PROJECT PPR
											JOIN PR_CAMPAIGN PC ON PPR.PROJECT_ID = PC.PROJECT_ID
											JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
											JOIN REF_DEMO RD ON PPR.TARGET_DEMO_ID=RD.DEMO_ID
											JOIN PR_PLAN_PROJECT PPP ON PPP.PROJECT_ID=PPR.PROJECT_ID
											JOIN PR_PLAN PP ON PP.PLAN_ID = PPP.PLAN_ID
											JOIN PR_PLAN_SCHEDULE PPS ON PPS.PLAN_ID = PP.PLAN_ID
											JOIN PR_CAMPAIGN_GOAL PCG ON PPS.CAMPAIGN_GOAL_ID = PCG.CAMPAIGN_GOAL_ID AND PCG.CAMPAIGN_ID = PC.CAMPAIGN_ID
											JOIN REF_CAL_PERIOD RCP ON PP.PERIOD_ID = RCP.PERIOD_ID
											JOIN REF_CAL_PERIOD W ON  W.PERIOD_TYPE_CD = 'W'
											JOIN REF_DAYPART RDT ON PPS.DAYPART_ID = RDT.DAYPART_ID AND RDT.ACTIVE_YN='Y'
											JOIN REF_SEGMENT RS ON RS.SEGMENT_ID=PCG.SEGMENT
											JOIN REF_CLUSTER RC ON 1=1
											JOIN CTE_FUTURE_ENDDATE CE ON 1=1
											JOIN CTE_NETWORK_DEMO CD ON 1=1
											WHERE PPP.PLAN_VERSION_ID = (SELECT IFNULL(MAX(PLAN_VERSION_ID),0) FROM PR_PLAN_VERSION WHERE PLAN_ID=PPS.PLAN_ID )
											AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
											AND PPS.MEDIA_OUTLET_ID = PCG.MEDIA_OUTLET_ID
											AND PPS.START_DATE BETWEEN W.START_DATE AND W.END_DATE
											AND PPS.START_DATE BETWEEN GREATEST(DATE(PPR.start_date), :IN_WEEK_DATE) AND LEAST(DATE(PPR.end_date), :IN_WEEK_DATE) 
											AND PPS.START_DATE <= CE.MAP_END_DATE
											AND PPR.MEDIA_OUTLET_ID = PP.MEDIA_OUTLET_ID
											AND PP.ACTIVE_YN = 'Y'
											AND PPS.ACTIVE_YN='Y'
											AND PP.ACTIVE_YN='Y'
											AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID 
											AND RC.CLUSTER_ID=case when PPP.CLUSTER_ID is null then 1=1 else  PPP.CLUSTER_ID end 
											AND :IN_PLAN_ID=0
											GROUP BY PPS.DAYPART_ID , PC.CAMPAIGN_ID,PC.NAME,PC.PROJECT_ID,RCT.NAME,PCG.FREQUENCY,RD.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_START_DATE,         
											PPP.ON_MAP_END_DATE,RCT.DISPLAY_SEQ,
											PPP.STATUS_CD,PPR.PREMIERE_DATE,RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,RDT.DAYPART_ID,RDT.NAME,PPS.PLANNED_UNITS,PPS.PLANNED_GRP,PP.NAME,
											PP.CREATE_DT,PPS.START_DATE,PCG.START_DATE,PCG.END_DATE,PPR.NAME,CD.NETWORK_DEMO,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,PPP.CLUSTER_ID,
											PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PP.PLAN_ID
											ORDER BY RCT.display_seq ASC, PC.CAMPAIGN_ID DESC , RDT.DAYPART_ID
									)
									,CTE_PLAN_PROJECTS AS (
										SELECT PLAN_ID,PROJECT_ID FROM CTE_PRIMARY_PLAN
										GROUP BY PLAN_ID,PROJECT_ID
									)
									,CTE_PLAN_ENDDATE AS (
										SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_END_DT FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID
										AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
										JOIN CTE_PLAN_PROJECTS CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
										GROUP BY CP.PROJECT_ID
									)
									,CTE_EPISODE_ENDDATE AS (
											SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_EPISODIC_END_DT FROM PR_PLAN_PROJECT_EPISODE PPP
											INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
											JOIN CTE_PLAN_PROJECTS CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
											GROUP BY CP.PROJECT_ID
									)
									,CTE_VERSION AS (
											SELECT P1.PROJECT_ID,
											CONCAT('v',COALESCE(P2.OPT_PLAN_VERSION_ID, P1.OPT_PLAN_VERSION_ID)+1,' ',TO_CHAR(COALESCE(P2.V_EPISODIC_END_DT,P1.V_END_DT),'MM/DD/YYYY HH12:MI AM')) LAST_OPT_VERSION_TS
											FROM CTE_PLAN_ENDDATE P1
											LEFT JOIN CTE_EPISODE_ENDDATE P2
												ON P1.PROJECT_ID = P2.PROJECT_ID
									)
									SELECT CP.*,CV.LAST_OPT_VERSION_TS FROM CTE_PRIMARY_PLAN CP LEFT JOIN CTE_VERSION CV ON CV.PROJECT_ID = CP.PROJECT_ID;`,

		dailyMapPlannedDataResult1B: `
		                            -- (PLAN_ID!=0)
		                            -- :IN_PLAN_ID
									-- :IN_MEDIA_OUTLET_ID
									-- :IN_OUTPUT_TYPE
									-- :IN_WEEK_DATE

									WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
												WHERE PR.PLAN_ID=:IN_PLAN_ID  AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
										)
										,CTE_MODEL_TYPE AS(
												select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
												FROM CTE_PLAN_TYPE
										)
										,CTE_PAST_PLAN  AS (
												SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
												JOIN CTE_PLAN_TYPE CP ON 1=1
												WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
												JOIN CTE_PLAN_TYPE CP ON 1=1 
												WHERE PP.PLAN_ID=:IN_PLAN_ID AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
												AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
										)
										,CTE_VERSION_ID AS(
												SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
												WHERE MD.PLAN_ID=:IN_PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
										)
										,CTE_NETWORK_DEMO AS(
												SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
												WHERE RMD.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
										)
										,CTE_PERIOD_ID AS (
												SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
												WHERE PR.PLAN_ID=:IN_PLAN_ID AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
										)    
										,CTE_FUTURE_PERIOD_ID AS (
												select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
												where START_DATE IN (
												SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
												JOIN CTE_PERIOD_ID CI ON 1=1
												where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
												and  PERIOD_TYPE_CD='Q' LIMIT 1 
										)	  
										,CTE_FUTURE_ENDDATE AS (
												select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
												JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
										)
										,CTE_PLANNED_DATA AS(

												SELECT
												:IN_PLAN_ID AS PLAN_ID,
												PPR.PROJECT_ID,
												1 as EPISODE_ID,
												NULL CAMPAIGN_ID,
												PCG.FREQUENCY,
												RD.NAME AS DEMO,
												RCT.NAME AS TYPE,
												PPP.PROJ_REACH_PERCENT,
												CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) =0 then 1 
												ELSE DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
												RPS.NAME AS STATUS_CD,
												PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, -- PPR.PREMIERE_DATE,
												RS.SEGMENT_NAME SEGMENT,
												PPP.PROJ_PRIORITY PRIORITY,
												RDT.DAYPART_ID,
												RDT.NAME DAYPART,
												CASE WHEN :IN_OUTPUT_TYPE=1 THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
												PPS.START_DATE AS SELECTED_DATE,
												PCG.START_DATE AS PROJ_START_DATE,
												PCG.END_DATE AS PROJ_END_DATE,
												PPR.NAME PROJECT_NAME,
												'N' AS PAST_PROJECT,					
												RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
												PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
												CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
												PPR.USER_COMMENT AS PROJECT_COMMENT,
												SUM(PPS.PLANNED_GRP) PROJ_GRP,
												PPR.SCATTER_IMPS,
												PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
												PPP.TARGET_REACH_PCT TARGET_REACH,
												PPP.TARGET_GRP TARGET_GRP,
												PPP.CLUSTER_ID,
												RC.CLUSTER_NAME, 
												PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
												PPP.PROJ_GRP PROJ_PLANNED_GRP,
												PPR.EVENT_TYPE_ID AS EVENT_ID,
												RET.EVENT_TYPE_NAME AS EVENT_NAME,
												PPR.SUBEVENT_ID ,
												RES.SUBEVENT_NAME,
												PPP.PHASE_TYPE,
												RPT.DESCRIPTION PH_DESC,
												CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
												PPP.NO_OF_EPISODE
												FROM 
												PR_PLAN_SCHEDULE PPS 
												JOIN CTE_VERSION_ID CV ON 1=1
												JOIN PR_PROJECT PPR ON PPS.START_DATE =:IN_WEEK_DATE
												AND PPR.PROJECT_ID = PPS.PROJECT_ID 
												AND PPS.ACTIVE_YN='Y'
												AND PPS.PLAN_ID=:IN_PLAN_ID
												JOIN PR_CAMPAIGN_GOAL PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID  
												AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
												AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
												JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
												JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
												JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=:IN_PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
												AND PPP.PROJECT_ID=PPS.PROJECT_ID
												LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
												JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' and RDT.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
												LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
												LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID
												LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
												LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
												WHERE :IN_PLAN_ID<>0
												GROUP BY PPR.PROJECT_ID,PCG.FREQUENCY,RD.NAME,RCT.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
												RS.SEGMENT_NAME, PPP.PROJ_PRIORITY,RDT.DAYPART_ID,RDT.NAME,PPS.START_DATE,PCG.START_DATE,PCG.END_DATE,PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,
												PPR.USER_COMMENT,PPS.PLANNED_GRP,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,
												PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID,RES.SUBEVENT_NAME,PPP.PHASE_TYPE,
												RPT.DESCRIPTION,PPP.NO_OF_EPISODE,PPR.MEDIA_OUTLET_ID,PPP.EPISODE_PRIORITY
												
										UNION

												SELECT
												:IN_PLAN_ID AS PLAN_ID,
												PPR.PROJECT_ID,
												1 as EPISODE_ID,
												NULL CAMPAIGN_ID,
												PPP.FREQUENCY,
												RD.NAME AS DEMO,
												RCT.NAME AS TYPE,
												PPP.PROJ_REACH_PERCENT,
												CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) =0 then 1 ELSE DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) as no_of_weeks,
												RPS.NAME AS STATUS_CD,
												PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, -- PPR.PREMIERE_DATE,
												RS.SEGMENT_NAME SEGMENT,
												PPP.PROJ_PRIORITY PRIORITY,
												RDT.DAYPART_ID,
												RDT.NAME DAYPART,
												0 AS PLANNED_UNITS,
												PPS.START_DATE AS SELECTED_DATE,
												PPP.ON_MAP_START_DATE AS PROJ_START_DATE,
												PPP.ON_MAP_END_DATE AS PROJ_END_DATE,
												PPR.NAME PROJECT_NAME,
												'N' AS PAST_PROJECT,					
												RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,	
												PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
												CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
												PPR.USER_COMMENT AS PROJECT_COMMENT,
												0 PROJ_GRP,
												PPR.SCATTER_IMPS,
												PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
												PPP.TARGET_REACH_PCT TARGET_REACH,
												PPP.TARGET_GRP TARGET_GRP,
												PPP.CLUSTER_ID,
												RC.CLUSTER_NAME,
												PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
												PPP.PROJ_GRP PROJ_PLANNED_GRP,
												PPR.EVENT_TYPE_ID AS EVENT_ID,
												RET.EVENT_TYPE_NAME AS EVENT_NAME,
												PPR.SUBEVENT_ID ,
												RES.SUBEVENT_NAME,
												PPP.PHASE_TYPE,
												RPT.DESCRIPTION PH_DESC,
												CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
												PPP.NO_OF_EPISODE
												FROM 
												PR_PLAN_SCHEDULE_EPISODE PPS 
												JOIN CTE_VERSION_ID CV ON 1=1
												JOIN PR_PROJECT PPR ON PPS.START_DATE =:IN_WEEK_DATE
												AND PPR.PROJECT_ID = PPS.PROJECT_ID
												AND PPS.ACTIVE_YN='Y'
												AND PPS.PLAN_ID=:IN_PLAN_ID
												JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=:IN_PLAN_ID AND PPP.PLAN_VERSION_ID= CV.PLAN_VERSION_ID AND PPP.STATUS_CD <> 2
												AND PPP.PROJECT_ID=PPS.PROJECT_ID
												JOIN REF_DEMO RD ON PPP.ON_MAP_DEMO = RD.DEMO_ID
												JOIN REF_SEGMENT RS ON PPP.SEGMENT=RS.SEGMENT_ID
												JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
												LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
												JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' and RDT.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
												LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
												LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID
												LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
												LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
												WHERE NOT EXISTS 
													(
														select 1 FROM PR_PLAN_SCHEDULE PPS1 
														WHERE PPS1.START_DATE =:IN_WEEK_DATE
														AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
														AND PPS.ACTIVE_YN='Y'
														AND PPS.PLAN_ID=:IN_PLAN_ID
														AND PPS1.PROJECT_ID=PPS.PROJECT_ID
														AND PPS1.DAYPART_ID=PPS.DAYPART_ID
													)		
												AND :IN_PLAN_ID<>0
											GROUP BY PPR.PROJECT_ID,PPP.FREQUENCY,RD.NAME,RCT.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,RS.SEGMENT_NAME,
												PPP.PROJ_PRIORITY,RDT.DAYPART_ID,RDT.NAME,:IN_OUTPUT_TYPE,PPS.START_DATE,PPS.START_DATE,PPR.NAME,RCT.DISPLAY_SEQ, PPP.DISPLAY_SEQ,PPR.USER_COMMENT,
												PPS.PLANNED_GRP,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,PPP.CLUSTER_ID,RC.CLUSTER_NAME, PPP.PROJ_REACH_PERCENT,
												PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID,RES.SUBEVENT_NAME,PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.NO_OF_EPISODE,PPR.MEDIA_OUTLET_ID,
											PPP.EPISODE_PRIORITY
												
										UNION 

												SELECT 
												PPS.PLAN_ID,
												PPR.PROJECT_ID,
												1 as EPISODE_ID,
												NULL CAMPAIGN_ID,
												PCG.FREQUENCY,
												RD.NAME AS DEMO,
												RCT.NAME AS TYPE,
												PPP.PROJ_REACH_PERCENT,
												CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE) =0 then 1 
												ELSE DATEDIFF(DAY,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE) END /7) as no_of_weeks,
												RPS.NAME AS STATUS_CD,
												PPP.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, -- PPR.PREMIERE_DATE,
												RS.SEGMENT_NAME SEGMENT,
												PPP.PROJ_PRIORITY PRIORITY,
												RDT.DAYPART_ID,
												RDT.NAME DAYPART,
												CASE WHEN :IN_OUTPUT_TYPE=1 THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
												PPS.START_DATE AS SELECTED_DATE,
												PCG.START_DATE AS PROJ_START_DATE,
												PCG.END_DATE AS PROJ_END_DATE,
												PPR.NAME PROJECT_NAME,
												'Y' AS PAST_PROJECT,
												RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,
												PPP.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
												CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
												PPR.USER_COMMENT AS PROJECT_COMMENT,
												SUM(PPS.PLANNED_GRP) PROJ_GRP,
												PPR.SCATTER_IMPS,
												PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
												PPP.TARGET_REACH_PCT TARGET_REACH,
												PPP.TARGET_GRP TARGET_GRP,
												PPP.CLUSTER_ID,
												RC.CLUSTER_NAME,
												PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
												PPP.PROJ_GRP PROJ_PLANNED_GRP,
												PPR.EVENT_TYPE_ID AS EVENT_ID,
												RET.EVENT_TYPE_NAME AS EVENT_NAME,
												PPR.SUBEVENT_ID ,
												RES.SUBEVENT_NAME,
												PPP.PHASE_TYPE,
												RPT.DESCRIPTION PH_DESC,
												CASE WHEN PPP.EPISODE_PRIORITY=0 THEN NULL ELSE PPP.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
												PPP.NO_OF_EPISODE
												FROM 
												PR_PLAN_SCHEDULE PPS 
												JOIN CTE_PLAN_TYPE CT ON 1=1
												JOIN CTE_MODEL_TYPE CM ON 1=1
												JOIN CTE_PERIOD_ID CI ON 1=1
												JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PPS.PROJECT_ID 
												AND PPR.PROJECT_TYPE = CT.PLAN_TYPE 
												and PPS.START_DATE=:IN_WEEK_DATE
												AND PPS.ACTIVE_YN='Y'
												JOIN PR_CAMPAIGN_GOAL PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID
												AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
												AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
												JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
												JOIN PR_PLAN_PROJECT PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID 
												AND PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID and M.MODEL_TYPE_ID=CM.MODEL_TYPE 
												and M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and M.EXEC_STATUS_CD='C')
												and PPP.PLAN_ID<>:IN_PLAN_ID 
												LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP.PHASE_TYPE
												JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and P.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
												JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
												JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' and RDT.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
												LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
												LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID
												LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
												LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
												WHERE :IN_PLAN_ID<>0
												GROUP BY PPR.PROJECT_ID,PCG.FREQUENCY,RD.NAME,RCT.NAME,PPP.PROJ_REACH_PERCENT,PPP.ON_MAP_END_DATE,PPP.ON_MAP_START_DATE,RPS.NAME,PPP.ON_MAP_PREMIER_DATE,
												RS.SEGMENT_NAME,PPP.PROJ_PRIORITY,RDT.DAYPART_ID,RDT.NAME,PPS.START_DATE,PCG.START_DATE,PCG.END_DATE,PPS.PLAN_ID,
												PPR.NAME,RCT.DISPLAY_SEQ,PPP.DISPLAY_SEQ,PPR.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME,PPP.TARGET_REACH_PCT,PPP.TARGET_GRP,PPP.CLUSTER_ID,RC.CLUSTER_NAME,PPP.PROJ_REACH_PERCENT,PPP.PROJ_GRP,PPR.EVENT_TYPE_ID,
												RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,PPP.PHASE_TYPE,RPT.DESCRIPTION,PPP.EPISODE_PRIORITY,PPP.NO_OF_EPISODE
												
												UNION 
													
												SELECT 
												PPS.PLAN_ID,
												PPR.PROJECT_ID,
												1 as EPISODE_ID,
												NULL CAMPAIGN_ID,
												PCG.FREQUENCY,
												RD.NAME AS DEMO,
												RCT.NAME AS TYPE,
												PPP1.PROJ_REACH_PERCENT,
												CEIL(CASE WHEN DATEDIFF(DAY,PPP1.ON_MAP_START_DATE,PPP1.ON_MAP_END_DATE) =0 then 1 
												ELSE DATEDIFF(DAY,PPP1.ON_MAP_START_DATE,PPP1.ON_MAP_END_DATE) END /7) as no_of_weeks,
												RPS.NAME AS STATUS_CD,
												PPP1.ON_MAP_PREMIER_DATE AS PREMIERE_DATE, -- PPR.PREMIERE_DATE,
												RS.SEGMENT_NAME SEGMENT,
												PPP1.PROJ_PRIORITY PRIORITY,
												RDT.DAYPART_ID,
												RDT.NAME DAYPART,
												0 PLANNED_UNITS,
												PPS.START_DATE AS SELECTED_DATE,
												MIN(PCG.START_DATE) AS PROJ_START_DATE,
												MAX(PCG.END_DATE) AS PROJ_END_DATE,
												PPR.NAME PROJECT_NAME,
												'Y' AS PAST_PROJECT,
												RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,
												PPP1.DISPLAY_SEQ AS PROJECT_DISPLAY_SEQ,
												CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
												PPR.USER_COMMENT AS PROJECT_COMMENT,
												0 PROJ_GRP,
												PPR.SCATTER_IMPS,
												PPR.MEDIA_OUTLET_ID,
												RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
												PPP1.TARGET_REACH_PCT TARGET_REACH,
												PPP1.TARGET_GRP TARGET_GRP,
												PPP1.CLUSTER_ID,
												RC.CLUSTER_NAME, -- change 2.7.5 additional
												PPP1.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
												PPP1.PROJ_GRP PROJ_PLANNED_GRP,
												PPR.EVENT_TYPE_ID AS EVENT_ID,
												RET.EVENT_TYPE_NAME AS EVENT_NAME,
												PPR.SUBEVENT_ID ,
												RES.SUBEVENT_NAME,
												PPP1.PHASE_TYPE,
												RPT.DESCRIPTION PH_DESC,
												CASE WHEN PPP1.EPISODE_PRIORITY=0 THEN NULL ELSE PPP1.EPISODE_PRIORITY END AS EPISODE_PRIORITY,
												PPP1.NO_OF_EPISODE
												FROM 
												PR_PLAN_SCHEDULE_EPISODE PPS
												JOIN CTE_PLAN_TYPE CT ON 1=1
												JOIN CTE_MODEL_TYPE CM ON 1=1
												JOIN CTE_PERIOD_ID CI ON 1=1
												JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PPS.PROJECT_ID 
												AND PPR.PROJECT_TYPE = CT.PLAN_TYPE
												and PPS.START_DATE=:IN_WEEK_DATE
												AND PPS.ACTIVE_YN='Y' AND  PPS.PLAN_ID <> :IN_PLAN_ID
												JOIN PR_CAMPAIGN_GOAL_EPISODE PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID
												AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
												AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
												JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
												JOIN PR_PLAN_PROJECT_EPISODE PPP ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID and PPP.EPISODE_ID=PPS.EPISODE_ID
												AND PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M 
												where PLAN_ID=PPS.PLAN_ID and M.MODEL_TYPE_ID=CM.MODEL_TYPE and M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and M.EXEC_STATUS_CD='C')
												JOIN PR_PLAN P on P.PLAN_ID=PPS.PLAN_ID and P.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and P.PLAN_TYPE=CT.PLAN_TYPE and P.PERIOD_ID < CI.PERIOD_ID
												JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
												JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' and RDT.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
												JOIN PR_PLAN_PROJECT PPP1 on PPP1.PLAN_ID=PPS.PLAN_ID and PPP1.PROJECT_ID=PPS.PROJECT_ID and PPP1.PLAN_VERSION_ID=PPP.PLAN_VERSION_ID
												LEFT JOIN REF_PROJECT_PLAN_TYPE RPT ON RPT.TYPE_ID = PPP1.PHASE_TYPE
												LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
												LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
												LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID
												LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
												LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
												WHERE NOT EXISTS 
													(
														select 1 FROM PR_PLAN_SCHEDULE PPS1 
														WHERE PPS1.START_DATE =:IN_WEEK_DATE
														AND PPS1.ACTIVE_YN='Y'
														AND PPS1.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
														AND PPS1.PLAN_ID <> :IN_PLAN_ID
														AND PPS.PROJECT_ID=PPS1.PROJECT_ID
													)	
												AND :IN_PLAN_ID<>0
												GROUP BY PPR.PROJECT_ID,PCG.FREQUENCY,RD.NAME,RCT.NAME,PPP1.PROJ_REACH_PERCENT,PPP1.ON_MAP_START_DATE,PPP1.ON_MAP_END_DATE,RPS.NAME,PPP1.ON_MAP_PREMIER_DATE,
												RS.SEGMENT_NAME,PPP1.PROJ_PRIORITY,RDT.DAYPART_ID,RDT.NAME,PPS.START_DATE,PPR.NAME,RCT.DISPLAY_SEQ,	PPP1.DISPLAY_SEQ,
												PPR.MEDIA_OUTLET_ID,PPR.USER_COMMENT,PPR.SCATTER_IMPS,PPR.MEDIA_OUTLET_ID,RMO.SHORT_NAME,PPP1.TARGET_REACH_PCT,PPP1.TARGET_GRP,
												PPP1.CLUSTER_ID,RC.CLUSTER_NAME,PPP1.PROJ_REACH_PERCENT,PPP1.PROJ_GRP,PPR.EVENT_TYPE_ID,RET.EVENT_TYPE_NAME,PPR.SUBEVENT_ID ,RES.SUBEVENT_NAME,PPS.PLAN_ID,
												PPP1.PHASE_TYPE,RPT.DESCRIPTION,PPP1.EPISODE_PRIORITY,PPP1.NO_OF_EPISODE,PPP1.STATUS_CD
										)
										,CTE_PROJECT AS (
													SELECT DISTINCT PLAN_ID,PROJECT_ID FROM CTE_PLANNED_DATA
										)
										,CTE_PLAN_ENDDATE AS (
										SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_END_DT FROM PR_PLAN_PROJECT PPP INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID
										AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
										JOIN CTE_PROJECT CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
										GROUP BY CP.PROJECT_ID
									)
									,CTE_EPISODE_ENDDATE AS (
											SELECT CP.PROJECT_ID,MAX(ME.PLAN_VERSION_ID) OPT_PLAN_VERSION_ID, MAX(ME.EXEC_END_DT) AS V_EPISODIC_END_DT FROM PR_PLAN_PROJECT_EPISODE PPP
											INNER JOIN MODEL_EXEC ME ON PPP.PLAN_ID=ME.PLAN_ID AND PPP.PLAN_VERSION_ID=ME.PLAN_VERSION_ID
											JOIN CTE_PROJECT CP ON PPP.PLAN_ID=CP.PLAN_ID AND PPP.PROJECT_ID=CP.PROJECT_ID AND PPP.OPTIMIZE_YN='Y' AND EXEC_STATUS_CD = 'C'
											GROUP BY CP.PROJECT_ID
									)
									,CTE_UPDATED_VERSION AS (
											SELECT P1.PROJECT_ID,
											CONCAT('v',COALESCE(P2.OPT_PLAN_VERSION_ID, P1.OPT_PLAN_VERSION_ID)+1,' ',TO_CHAR(COALESCE(P2.V_EPISODIC_END_DT,P1.V_END_DT),'MM/DD/YYYY HH12:MI AM')) V_GET_VERSION
											FROM CTE_PLAN_ENDDATE P1
											LEFT JOIN CTE_EPISODE_ENDDATE P2
												ON P1.PROJECT_ID = P2.PROJECT_ID
									)
										,CTE_FINAL AS(
													SELECT CD.* EXCLUDE(PLAN_ID), V_GET_VERSION LAST_OPT_VERSION_TS FROM CTE_PLANNED_DATA CD 
													JOIN CTE_UPDATED_VERSION CV ON CD.PROJECT_ID =CV.PROJECT_ID
										)
										SELECT * FROM CTE_FINAL
										ORDER BY PROJECT_DISPLAY_SEQ  , PROJECT_NAME;`,

		dailyMapPlannedDataResult1: `
                                    -- :IN_PLAN_ID
									-- :IN_MEDIA_OUTLET_ID
									-- :IN_OUTPUT_TYPE
									-- :IN_WEEK_DATE

									WITH CTE_PLAN_TYPE AS (
											SELECT PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID  AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_MODEL_TYPE AS(
											select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
											FROM CTE_PLAN_TYPE
									)
									,CTE_PAST_PLAN  AS (
											SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PLAN_TYPE CP ON 1=1
											WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
											JOIN CTE_PLAN_TYPE CP ON 1=1 
											WHERE PP.PLAN_ID=:IN_PLAN_ID AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
											AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
									)
									,CTE_VERSION_ID AS(
											SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
											WHERE MD.PLAN_ID=:IN_PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											WHERE RMD.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	  
									,CTE_FUTURE_ENDDATE AS (
											select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
											JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
									)
									,CTE_CAPACITY AS (
													select PPC.DAYPART_ID,RD.NAME,PPC.CAPACITY_PER_HOUR from PR_PROMO_CAPACITY PPC 
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN REF_DAYPART RD on RD.DAYPART_ID=PPC.DAYPART_ID and RD.ACTIVE_YN='Y'
													where PPC.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and PPC.START_DATE=:IN_WEEK_DATE
													AND :IN_OUTPUT_TYPE=1 AND CT.PLAN_TYPE=1
													
													UNION
													
													select PPC.DAYPART_ID,RD.NAME,PPCG.GRP_CAPACITY CAPACITY_PER_HOUR 
													from PR_PROMO_CAPACITY PPC 
													JOIN CTE_NETWORK_DEMO CD ON 1=1
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN PR_PROMO_CAPACITY_GRP PPCG
													ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID and PPCG.DEMO_ID=CD.NETWORK_DEMO
													JOIN REF_DAYPART RD on RD.DAYPART_ID=PPC.DAYPART_ID  AND RD.ACTIVE_YN='Y'
													where PPC.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and PPC.START_DATE=:IN_WEEK_DATE 
													AND :IN_OUTPUT_TYPE<>1 AND CT.PLAN_TYPE=1
													
													UNION
													
													select PPC.DAYPART_ID,RD.NAME,PPC.CAPACITY_PER_HOUR 
													from PR_2E_CAPACITY PPC 
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN REF_DAYPART RD on RD.DAYPART_ID=PPC.DAYPART_ID 
													and RD.ACTIVE_YN='Y'
													where PPC.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and PPC.START_DATE=:IN_WEEK_DATE 
													AND :IN_OUTPUT_TYPE=1 AND CT.PLAN_TYPE<>1
													
													UNION 
													
													select PPC.DAYPART_ID,RD.NAME,PPCG.GRP_CAPACITY CAPACITY_PER_HOUR
													from PR_2E_CAPACITY PPC 
													JOIN CTE_PLAN_TYPE CT ON 1=1
													JOIN CTE_NETWORK_DEMO CD ON 1=1
													INNER JOIN PR_2E_CAPACITY_GRP PPCG
													ON PPC.CAPACITY_ID=PPCG.CAPACITY_ID and PPCG.DEMO_ID=CD.NETWORK_DEMO
													JOIN REF_DAYPART RD on RD.DAYPART_ID=PPC.DAYPART_ID  AND RD.ACTIVE_YN='Y'
													where PPC.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and PPC.START_DATE=:IN_WEEK_DATE 
													AND :IN_OUTPUT_TYPE<>1 AND CT.PLAN_TYPE<>1 
									)
									SELECT * FROM CTE_CAPACITY;`,

		dailyMapPlannedDataResult2: `
		                            -- :IN_PLAN_ID
									-- :IN_MEDIA_OUTLET_ID
									-- :IN_OUTPUT_TYPE
									-- :IN_WEEK_DATE

									WITH CTE_PLAN_TYPE AS (
											SELECT PLAN_TYPE AS PLAN_TYPE FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID  AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)
									,CTE_MODEL_TYPE AS(
											select case when PLAN_TYPE=1 then 1 when PLAN_TYPE = 2 then 3 end AS MODEL_TYPE
											FROM CTE_PLAN_TYPE
									)
									,CTE_PAST_PLAN  AS (
											SELECT IFNULL(PR.PLAN_ID,0) AS PAST_PLAN_ID FROM PR_PLAN PR
											JOIN CTE_PLAN_TYPE CP ON 1=1
											WHERE PERIOD_ID=(SELECT PP.PERIOD_ID-1 FROM PR_PLAN PP 
											JOIN CTE_PLAN_TYPE CP ON 1=1 
											WHERE PP.PLAN_ID=:IN_PLAN_ID AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND PP.PLAN_TYPE=CP.PLAN_TYPE LIMIT 1) 
											AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND ACTIVE_YN='Y' AND PR.PLAN_TYPE=CP.PLAN_TYPE
									)
									,CTE_VERSION_ID AS(
											SELECT IFNULL(MAX(PLAN_VERSION_ID),0) AS PLAN_VERSION_ID FROM MODEL_EXEC MD
											WHERE MD.PLAN_ID=:IN_PLAN_ID AND EXEC_STATUS_CD='C' LIMIT 1
									)
									,CTE_NETWORK_DEMO AS(
											SELECT DEMO_ID AS NETWORK_DEMO FROM REF_MEDIA_OUTLET_DEMO RMD
											WHERE RMD.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID AND DEFAULT_YN='Y' LIMIT 1
									)
									,CTE_PERIOD_ID AS (
											SELECT PERIOD_ID AS PERIOD_ID FROM PR_PLAN PR
											WHERE PR.PLAN_ID=:IN_PLAN_ID AND PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID LIMIT 1
									)    
									,CTE_FUTURE_PERIOD_ID AS (
											select PERIOD_ID AS FUTURE_PERIOD_ID FROM REF_CAL_PERIOD 
											where START_DATE IN (
											SELECT DATEADD(DAY,1,END_DATE) FROM REF_CAL_PERIOD RD
											JOIN CTE_PERIOD_ID CI ON 1=1
											where RD.PERIOD_ID=CI.PERIOD_ID and PERIOD_TYPE_CD='Q' LIMIT 1)
											and  PERIOD_TYPE_CD='Q' LIMIT 1 
									)	  
									,CTE_FUTURE_ENDDATE AS (
											select END_DATE AS MAP_END_DATE from REF_CAL_PERIOD RD
											JOIN CTE_FUTURE_PERIOD_ID CF ON PERIOD_ID= FUTURE_PERIOD_ID
									)
									,CTE_FUTURE_ID AS(
												SELECT PR.PLAN_ID AS FUTURE_PLAN_ID FROM PR_PLAN PR
												JOIN CTE_FUTURE_PERIOD_ID CF ON 1=1
												JOIN CTE_PLAN_TYPE CT ON 1=1
												where PERIOD_ID=CF.FUTURE_PERIOD_ID and PR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID 
												and PR.PLAN_TYPE = CT.PLAN_TYPE LIMIT 1
									)
									,CTE_FUTURE_PLAN AS (
											SELECT A.DAYPART_ID, A.NAME, SUM(A.FUTURE_PLANNED_UNITS) FUTURE_PLANNED_UNITS
											FROM(
											SELECT PPS.DAYPART_ID,RD.NAME, SUM(PLANNED_UNITS) FUTURE_PLANNED_UNITS from PR_PLAN_SCHEDULE PPS
											JOIN CTE_FUTURE_ID CF ON 1=1
											JOIN REF_DAYPART RD on PPS.DAYPART_ID = RD.DAYPART_ID AND RD.ACTIVE_YN='Y'
											where PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID and PPS.PLAN_ID = CF.FUTURE_PLAN_ID 
											and PPS.START_DATE=:IN_WEEK_DATE AND :IN_OUTPUT_TYPE=1
											GROUP BY PPS.DAYPART_ID,RD.NAME
											
											UNION ALL
											
											SELECT PPS.DAYPART_ID,RD.NAME, SUM(PLANNED_UNITS) FUTURE_PLANNED_UNITS from PR_PLAN_SCHEDULE_EPISODE PPS
											JOIN CTE_FUTURE_ID CF ON 1=1
											JOIN REF_DAYPART RD on PPS.DAYPART_ID = RD.DAYPART_ID AND RD.ACTIVE_YN='Y'
											where PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID and PPS.PLAN_ID = CF.FUTURE_PLAN_ID 
											and PPS.START_DATE=:IN_WEEK_DATE AND :IN_OUTPUT_TYPE=1
											GROUP BY PPS.DAYPART_ID,RD.NAME)A 
											GROUP BY A.DAYPART_ID, A.NAME
									UNION
											SELECT A.DAYPART_ID, A.NAME, SUM(A.FUTURE_PLANNED_UNITS) FUTURE_PLANNED_UNITS 
											FROM(
											SELECT PPS.DAYPART_ID,RD.NAME, SUM(PLANNED_GRP) FUTURE_PLANNED_UNITS from PR_PLAN_SCHEDULE PPS
											JOIN CTE_FUTURE_ID CF ON 1=1
											JOIN REF_DAYPART RD on PPS.DAYPART_ID = RD.DAYPART_ID AND RD.ACTIVE_YN='Y'
											where PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID and PPS.PLAN_ID = CF.FUTURE_PLAN_ID 
											and PPS.START_DATE=:IN_WEEK_DATE
											GROUP BY PPS.DAYPART_ID,RD.NAME
											
											UNION ALL
											
											SELECT PPS.DAYPART_ID,RD.NAME, SUM(PLANNED_GRP) FUTURE_PLANNED_UNITS from PR_PLAN_SCHEDULE_EPISODE PPS
											JOIN CTE_FUTURE_ID CF ON 1=1
											JOIN REF_DAYPART RD on PPS.DAYPART_ID = RD.DAYPART_ID AND RD.ACTIVE_YN='Y'
											where PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID and PPS.PLAN_ID = CF.FUTURE_PLAN_ID 
											and PPS.START_DATE=:IN_WEEK_DATE
											GROUP BY PPS.DAYPART_ID,RD.NAME)A 
											GROUP BY A.DAYPART_ID, A.NAME
									)
									SELECT * FROM CTE_FUTURE_PLAN;`,

		dailyMapPlannedEpisodesData: `
											-- 1. :IN_PLAN_ID
											-- 2. :IN_WEEK_DATE
											-- 3. :IN_MEDIA_OUTLET_ID	
											-- 4. IN_OUTPUT_TYPE

											WITH CTE_PLAN_TYPE AS (
												SELECT PLAN_TYPE,PP.PLAN_ID,IFNULL(MAX(PLAN_VERSION_ID),0) V_PLAN_VERSION_ID,PERIOD_ID FROM PR_PLAN PP
												INNER JOIN MODEL_EXEC ME ON ME.PLAN_ID = PP.PLAN_ID 
												WHERE PP.PLAN_ID = :IN_PLAN_ID
												AND PP.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
												GROUP BY PP.PLAN_ID,PP.PLAN_TYPE,PERIOD_ID

											) -- SELECT * FROM CTE_PLAN_TYPE;

											,CTE_PAST_PLAN AS ( 
												SELECT IFNULL(PP.PLAN_ID,0) PLAN_ID,MAX(PLAN_VERSION_ID) V_PAST_PLAN_VERSION_ID,
												PP.PERIOD_ID FROM PR_PLAN PP
													INNER JOIN MODEL_EXEC ME ON ME.PLAN_ID = PP.PLAN_ID AND EXEC_STATUS_CD = 'C'
													WHERE PERIOD_ID=(SELECT PP.PERIOD_ID - 1 FROM PR_PLAN PP WHERE PLAN_ID = :IN_PLAN_ID 
																	AND PP.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID 
																	AND PLAN_TYPE= (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)) 
													AND PP.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID 
													AND ACTIVE_YN='Y' 
													AND PLAN_TYPE=(SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
													GROUP BY PP.PLAN_ID,PP.PERIOD_ID
											) -- SELECT * FROM CTE_PAST_PLAN;

											SELECT
													PPR.PROJECT_ID,
													PPS.EPISODE_ID,
													PC.CAMPAIGN_ID,
													PCG.FREQUENCY,
													RD.NAME AS DEMO,
													RCT.NAME AS TYPE,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) = 0 THEN 1 ELSE
													DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7) AS NO_OF_WEEKS,
													RPS.NAME AS STATUS_CD,
													PPR.PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													RDT.DAYPART_ID,
													RDT.NAME DAYPART,
													CASE WHEN(:IN_OUTPUT_TYPE = 1) THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
													PPS.START_DATE AS SELECTED_DATE,
													
													PCG.START_DATE AS PROJ_START_DATE,
													PCG.END_DATE AS PROJ_END_DATE,
													PPR.NAME PROJECT_NAME,
													'N' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,
													NULL PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS.PLANNED_GRP) PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
													NULL TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME,
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP,
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													TO_CHAR(PPP.EPISODE_START_TS,'MM/DD/YYYY HH12:MM:SS AM') EPISODE_START_TS
													FROM 
													PR_PLAN_SCHEDULE_EPISODE PPS 
													JOIN PR_PROJECT PPR ON PPS.START_DATE = :IN_WEEK_DATE 
														AND PPR.PROJECT_ID = PPS.PROJECT_ID 
														AND PPS.ACTIVE_YN='Y'
														AND PPS.PLAN_ID=:IN_PLAN_ID
													JOIN PR_CAMPAIGN PC ON PPR.PROJECT_ID=PC.PROJECT_ID
													JOIN PR_CAMPAIGN_GOAL_EPISODE PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID 
													AND PC.CAMPAIGN_ID=PCG.CAMPAIGN_ID AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
													AND PPS.EPISODE_ID = PCG.EPISODE_ID
													AND PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID
													JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
													JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN PR_PLAN_PROJECT_EPISODE PPP ON PPP.PROJECT_ID=PPS.PROJECT_ID
													AND PPP.EPISODE_ID=PPS.EPISODE_ID
													AND PPP.PLAN_ID= :IN_PLAN_ID
													AND PPP.PLAN_VERSION_ID= (SELECT V_PLAN_VERSION_ID FROM CTE_PLAN_TYPE)
													JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' 
													AND RDT.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
													LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID
													
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													GROUP BY PPS.DAYPART_ID , PC.CAMPAIGN_ID, PPS.EPISODE_ID,PPR.PROJECT_ID,PCG.FREQUENCY,RD.NAME ,
													RCT.NAME ,PPP.PROJ_REACH_PERCENT,NO_OF_WEEKS,RPS.NAME ,
													PPR.PREMIERE_DATE,RS.SEGMENT_NAME ,PPP.PROJ_PRIORITY ,
													RDT.DAYPART_ID,RDT.NAME,PPS.START_DATE ,PCG.START_DATE ,PCG.END_DATE ,PPR.NAME ,
													PAST_PROJECT,RCT.DISPLAY_SEQ ,PROJECT_DISPLAY_SEQ,NETWORK_DISPLAY_SEQ,PPR.USER_COMMENT ,PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME ,TARGET_REACH,PPP.TARGET_GRP, PPP.CLUSTER_ID, RC.CLUSTER_NAME,
													PPP.PROJ_REACH_PERCENT ,PPP.PROJ_GRP ,PPR.EVENT_TYPE_ID ,RET.EVENT_TYPE_NAME ,PPR.SUBEVENT_ID,
													RES.SUBEVENT_NAME,EPISODE_START_TS

													
													UNION

												SELECT 
													PPR.PROJECT_ID,
													PPS.EPISODE_ID,
													PC.CAMPAIGN_ID,
													PCG.FREQUENCY,
													RD.NAME AS DEMO,
													RCT.NAME AS TYPE,
													PPP.PROJ_REACH_PERCENT,
													CEIL(CASE WHEN DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE)= 0 THEN 1 ELSE DATEDIFF(DAY,PPP.ON_MAP_START_DATE,PPP.ON_MAP_END_DATE) END /7)  NO_OF_WEEKS,
													RPS.NAME AS STATUS_CD,
													PPR.PREMIERE_DATE,
													RS.SEGMENT_NAME SEGMENT,
													PPP.PROJ_PRIORITY PRIORITY,
													RDT.DAYPART_ID,
													RDT.NAME DAYPART,
													CASE WHEN (:IN_OUTPUT_TYPE = 1) THEN SUM(PPS.PLANNED_UNITS) ELSE SUM(PPS.PLANNED_GRP) END AS PLANNED_UNITS,
													PPS.START_DATE AS SELECTED_DATE,
													PCG.START_DATE AS PROJ_START_DATE,
													PCG.END_DATE AS PROJ_END_DATE,
													PPR.NAME PROJECT_NAME,
													'Y' AS PAST_PROJECT,					
													RCT.DISPLAY_SEQ CAMPAIGN_DISPLAY_SEQ,
													NULL PROJECT_DISPLAY_SEQ,
													CASE WHEN PPR.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID THEN 1 ELSE 99 END AS NETWORK_DISPLAY_SEQ,
													PPR.USER_COMMENT AS PROJECT_COMMENT,
													SUM(PPS.PLANNED_GRP) PROJ_GRP,
													PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME AS MEDIA_OUTLET_NAME,
													NULL TARGET_REACH,
													PPP.TARGET_GRP TARGET_GRP,
													PPP.CLUSTER_ID, 
													RC.CLUSTER_NAME,
													PPP.PROJ_REACH_PERCENT PROJ_PLANNED_REACH,
													PPP.PROJ_GRP PROJ_PLANNED_GRP,
													PPR.EVENT_TYPE_ID AS EVENT_ID,
													RET.EVENT_TYPE_NAME AS EVENT_NAME,
													PPR.SUBEVENT_ID ,
													RES.SUBEVENT_NAME,
													TO_CHAR(PPP.EPISODE_START_TS,'MM/DD/YYYY HH12:MM:SS AM') EPISODE_START_TS
																
													FROM 
													PR_PLAN_SCHEDULE_EPISODE PPS 
													JOIN PR_PROJECT PPR ON  PPR.PROJECT_ID = PPS.PROJECT_ID 
													AND PPR.PROJECT_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
													and PPS.START_DATE=:IN_WEEK_DATE  
													AND PPS.ACTIVE_YN='Y'
													JOIN PR_CAMPAIGN PC ON PPR.PROJECT_ID=PC.PROJECT_ID
													JOIN PR_CAMPAIGN_GOAL_EPISODE PCG ON PPS.CAMPAIGN_GOAL_ID=PCG.CAMPAIGN_GOAL_ID
													AND PC.CAMPAIGN_ID=PCG.CAMPAIGN_ID AND PPS.MEDIA_OUTLET_ID=PCG.MEDIA_OUTLET_ID
													AND PPS.EPISODE_ID = PCG.EPISODE_ID
													AND PPS.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
													JOIN REF_SEGMENT RS ON PCG.SEGMENT=RS.SEGMENT_ID
													JOIN REF_MEDIA_OUTLET RMO ON PPR.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID
													JOIN PR_PLAN_PROJECT_EPISODE PPP 
													ON PPP.PLAN_ID=PPS.PLAN_ID AND PPP.PROJECT_ID=PPS.PROJECT_ID
													AND PPP.EPISODE_ID=PPS.EPISODE_ID
													AND PPP.PLAN_VERSION_ID= (select MAX(PLAN_VERSION_ID) from MODEL_EXEC M where PLAN_ID=PPS.PLAN_ID 
													and M.MODEL_TYPE_ID =  (CASE WHEN (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) = 1 THEN 1 ELSE 3 END)
													and M.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID and M.EXEC_STATUS_CD='C')
													and PPP.PLAN_ID<>:IN_PLAN_ID
													JOIN PR_PLAN P ON P.PLAN_ID=PPS.PLAN_ID AND P.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID 
													AND P.PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE) 
													and P.PERIOD_ID < (SELECT PERIOD_ID FROM CTE_PLAN_TYPE)
													
													JOIN REF_DEMO RD ON PCG.DEMO_ID = RD.DEMO_ID
													JOIN REF_DAYPART RDT ON RDT.DAYPART_ID=PPS.DAYPART_ID AND RDT.ACTIVE_YN='Y' 
													AND RDT.MEDIA_OUTLET_ID= :IN_MEDIA_OUTLET_ID
													LEFT JOIN REF_PLAN_STATUS RPS ON RPS.PLAN_STATUS_ID=PPP.STATUS_CD
													LEFT JOIN REF_CAMPAIGN_TYPE RCT ON PPR.CAMPAIGN_TYPE_ID = RCT.CAMPAIGN_TYPE_ID
													LEFT JOIN REF_CLUSTER RC on PPP.CLUSTER_ID=RC.CLUSTER_ID		
													LEFT JOIN REF_2E_EVENT_SUBTYPE_PROJECT RES ON RES.SUBEVENT_ID=PPR.SUBEVENT_ID
													LEFT JOIN REF_2E_EVENT_TYPE RET ON RET.EVENT_TYPE_ID=PPR.EVENT_TYPE_ID
													
													GROUP BY PPS.DAYPART_ID , PC.CAMPAIGN_ID, PPS.EPISODE_ID,PPR.PROJECT_ID,PCG.FREQUENCY,RD.NAME ,
													RCT.NAME ,PPP.PROJ_REACH_PERCENT,NO_OF_WEEKS,RPS.NAME ,
													PPR.PREMIERE_DATE,RS.SEGMENT_NAME ,PPP.PROJ_PRIORITY ,
													RDT.DAYPART_ID,RDT.NAME,PPS.START_DATE ,PCG.START_DATE ,PCG.END_DATE ,PPR.NAME ,
													PAST_PROJECT,RCT.DISPLAY_SEQ ,PROJECT_DISPLAY_SEQ,NETWORK_DISPLAY_SEQ,PPR.USER_COMMENT ,PPR.SCATTER_IMPS,
													PPR.MEDIA_OUTLET_ID,
													RMO.SHORT_NAME ,TARGET_REACH,PPP.TARGET_GRP, PPP.CLUSTER_ID, RC.CLUSTER_NAME,
													PPP.PROJ_REACH_PERCENT ,PPP.PROJ_GRP ,PPR.EVENT_TYPE_ID ,RET.EVENT_TYPE_NAME ,PPR.SUBEVENT_ID,
													RES.SUBEVENT_NAME,EPISODE_START_TS;`,

		dailyMapPlannedEpisodeDataResult2: `
											-- 1. :IN_PLAN_ID
											-- 2. :IN_WEEK_DATE
											-- 3. :IN_MEDIA_OUTLET_ID 
											-- 4. :IN_OUTPUT_TYPE

											WITH CTE_PLAN_TYPE AS (
											SELECT PLAN_TYPE,PERIOD_ID FROM PR_PLAN WHERE PLAN_ID = :IN_PLAN_ID
											)
											SELECT PPS.DAYPART_ID,RD.NAME,CASE WHEN :IN_OUTPUT_TYPE = 1 THEN  SUM(PLANNED_UNITS) ELSE SUM(PLANNED_GRP) END FUTURE_PLANNED_UNITS from PR_PLAN_SCHEDULE_EPISODE PPS
													JOIN REF_DAYPART RD on PPS.DAYPART_ID = RD.DAYPART_ID AND RD.ACTIVE_YN='Y'
													where PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID 
													AND PLAN_ID = (SELECT PLAN_ID FROM PR_PLAN WHERE PERIOD_ID = (SELECT (PERIOD_ID + 1) FROM CTE_PLAN_TYPE)
													AND PLAN_TYPE = (SELECT PLAN_TYPE FROM CTE_PLAN_TYPE)
													AND MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID)
													AND PPS.START_DATE=:IN_WEEK_DATE
													GROUP BY PPS.DAYPART_ID,RD.NAME;`,

		projectEpisodicPopupData: `
										-- 1.IN_MEDIA_OUTLET_ID
										-- 2.IN_PROJECT_ID
										-- 3.IN_PLAN_ID
										-- 4.IN_DEMO_ID

										WITH CTE_VERSION AS(
										SELECT IFNULL(MAX(PLAN_VERSION_ID), 0) AS PLAN_VERSION_ID FROM MODEL_EXEC ME
										WHERE ME.PLAN_ID = :IN_PLAN_ID AND EXEC_STATUS_CD = 'C' limit 1
									)
									,PROJ_EPISODE_DTL AS(
										SELECT PR.PROJECT_ID, 1 AS EPISODE_ID, DATE(PCG.START_DATE) AS START_DATE, DATE(PCG.END_DATE) AS END_DATE,
										GET_TIME_TO_OFFSET(PCG.START_TIME) AS START_TIME, GET_TIME_TO_OFFSET(PCG.END_TIME) AS END_TIME,
										CONCAT(PCG.END_DATE, ' ', PCG.END_TIME) AS PREMIERE_DATE
										FROM PR_PROJECT PR
									JOIN CTE_VERSION CV ON 1=1
										JOIN PR_CAMPAIGN_GOAL PCG ON PR.PROJECT_ID=PCG.PROJECT_ID
										AND PCG.PLAN_ID=:IN_PLAN_ID
										WHERE PR.PROJECT_ID=:IN_PROJECT_ID
										UNION
										SELECT PCG.PROJECT_ID, PCG.EPISODE_ID, DATE(PCG.START_DATE) AS START_DATE,
										DATE(PCG.END_DATE) AS END_DATE,
										GET_TIME_TO_OFFSET(PCG.START_TIME)+1 START_TIME,
										GET_TIME_TO_OFFSET(PCG.END_TIME) END_TIME, CONCAT(PCG.END_DATE, ' ', PCG.END_TIME) AS PREMIERE_DATE
										FROM PR_PLAN_PROJECT_EPISODE PPP
									JOIN CTE_VERSION CV ON 1=1
										JOIN PR_CAMPAIGN_GOAL_EPISODE PCG
										ON PPP.PLAN_ID=:IN_PLAN_ID AND PPP.PLAN_VERSION_ID=CV.PLAN_VERSION_ID
										AND PPP.PLAN_ID=PCG.PLAN_ID AND PPP.PROJECT_ID=PCG.PROJECT_ID
										AND PPP.EPISODE_ID=PCG.EPISODE_ID
										AND PCG.PROJECT_ID=:IN_PROJECT_ID
									)
									,DAY_DAYPART AS (
										SELECT PP.PROJECT_ID, PP.EPISODE_ID, RCP.START_DATE, RCP.END_DATE, RD.DAYPART_ID, RD.NAME, START_OFFSET, END_OFFSET, PP.PREMIERE_DATE
										FROM REF_CAL_PERIOD RCP
									INNER JOIN REF_DAYPART RD ON RD.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID and ACTIVE_YN='Y'
										INNER JOIN REF_DAYPART_DEFN RDD ON RD.DAYPART_ID=RDD.DAYPART_ID
										INNER JOIN PROJ_EPISODE_DTL PP
										ON RCP.START_DATE BETWEEN PP.START_DATE AND PP.END_DATE
										AND RCP.PERIOD_TYPE_CD='D'
									)
									,LAUNCH_DATA AS (
										SELECT
										RCP.START_DATE AS BROADCAST_DATE,
										RCP.DAYPART_ID,
										RCP.NAME,
										RCP.EPISODE_ID,
										'Launch' AS PHASE,
										RCP.PREMIERE_DATE  AS AIRING_DATE,
										ifnull(PPS.PLANNED_UNITS,0)  as PLANNED_UNITS,
										ifnull(PPS.PLANNED_GRP,0)  as PLANNED_GRP,
										1 AS DATA_TYPE,          -- LAUNCH DATA
										RCP.PROJECT_ID
										FROM DAY_DAYPART RCP
									LEFT JOIN PR_PLAN_SCHEDULE PPS ON
										PPS.PLAN_ID = :IN_PLAN_ID AND PPS.DEMO_ID = :IN_DEMO_ID
										AND PPS.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID AND PPS.PROJECT_ID = :IN_PROJECT_ID
										AND PPS.DAYPART_ID=RCP.DAYPART_ID
										AND PPS.START_DATE = RCP.START_DATE
										WHERE RCP.EPISODE_ID=1
										GROUP BY RCP.PROJECT_ID, RCP.EPISODE_ID, RCP.START_DATE, RCP.DAYPART_ID, RCP.NAME,RCP.PREMIERE_DATE,
										PPS.PLANNED_UNITS,PPS.PLANNED_GRP
										-- ORDER BY BROADCAST_DATE, DAYPART_ID, RCP.PROJECT_ID, RCP.EPISODE_ID, RCP.DAYPART_ID
									)
									,EPISODE_DATA AS (
										SELECT
										CAST(RCP.START_DATE AS STRING) AS BROADCAST_DATE,
										RCP.DAYPART_ID,
										RCP.NAME,
										RCP.EPISODE_ID,
										concat('Episode',RCP.EPISODE_ID) AS PHASE,
										RCP.PREMIERE_DATE AS AIRING_DATE,
										ifnull(PPSE.PLANNED_UNITS,0)  as PLANNED_UNITS,
										ifnull(PPSE.PLANNED_GRP,0)  as PLANNED_GRP,
										2 AS DATA_TYPE,
										RCP.PROJECT_ID
										FROM DAY_DAYPART RCP
									LEFT JOIN PR_PLAN_SCHEDULE_EPISODE PPSE ON
										PPSE.PLAN_ID = :IN_PLAN_ID AND PPSE.DEMO_ID = :IN_DEMO_ID
										AND PPSE.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID AND PPSE.PROJECT_ID = :IN_PROJECT_ID
										AND RCP.PROJECT_ID=PPSE.PROJECT_ID
										AND RCP.EPISODE_ID=PPSE.EPISODE_ID
										AND PPSE.DAYPART_ID=RCP.DAYPART_ID
										AND PPSE.START_DATE = RCP.START_DATE
										WHERE RCP.EPISODE_ID>1
										GROUP BY RCP.PROJECT_ID, RCP.EPISODE_ID, RCP.START_DATE, RCP.DAYPART_ID,RCP.NAME,RCP.PREMIERE_DATE,
										PPSE.PLANNED_UNITS,PPSE.PLANNED_GRP
										-- ORDER BY BROADCAST_DATE, DAYPART_ID, RCP.PROJECT_ID, RCP.EPISODE_ID, RCP.DAYPART_ID
									)
									SELECT TO_VARCHAR(BROADCAST_DATE) AS BROADCAST_DATE, L.* EXCLUDE(BROADCAST_DATE) FROM LAUNCH_DATA L
									UNION
									SELECT TO_VARCHAR(BROADCAST_DATE) AS BROADCAST_DATE,D.* EXCLUDE(BROADCAST_DATE) FROM EPISODE_DATA D
									UNION
									SELECT  'TOTAL' AS BROADCAST_DATE ,DAYPART_ID,MAX(NAME) AS NAME,NULL,NULL,NULL,SUM(PLANNED_UNITS) PLANNED_UNITS,
									SUM(PLANNED_GRP) PLANNED_GRP,3 AS DATA_TYPE,T.PROJECT_ID
									FROM
									(
										SELECT L.* EXCLUDE(BROADCAST_DATE), TO_VARCHAR(BROADCAST_DATE) AS BROADCAST_DATE   FROM LAUNCH_DATA L
										UNION
										SELECT  D.* EXCLUDE(BROADCAST_DATE), TO_VARCHAR(BROADCAST_DATE) AS BROADCAST_DATE  FROM EPISODE_DATA D
									) T GROUP BY DAYPART_ID,T.PROJECT_ID
									UNION
									SELECT TO_VARCHAR(BROADCAST_DATE) AS BROADCAST_DATE,NULL,NULL,NULL,NULL,NULL,SUM(PLANNED_UNITS) PLANNED_UNITS,
									SUM(PLANNED_GRP) PLANNED_GRP,4 AS DATA_TYPE,T2.PROJECT_ID
									FROM
									(
										SELECT * FROM LAUNCH_DATA
										UNION
										SELECT * FROM EPISODE_DATA
									)  T2 GROUP BY BROADCAST_DATE,EPISODE_ID,T2.PROJECT_ID
									ORDER BY DATA_TYPE,BROADCAST_DATE, DAYPART_ID, PROJECT_ID, EPISODE_ID, DAYPART_ID;`,

		projectEpisodicPopupDataDisplaySeq: `
										-- 1.IN_MEDIA_OUTLET_ID

										SELECT row_number() OVER (ORDER BY DAYPART_ID ASC) AS DISPLAY_SEQ,DAYPART_ID, NAME
										FROM REF_DAYPART RD
										WHERE RD.MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID AND ACTIVE_YN = 'Y' ORDER BY DAYPART_ID;`,

		episodicRulesPopupData: `
										WITH CTE_MAX_VERSION AS (
												SELECT IFNULL(MAX(PLAN_VERSION_ID), 0) V_PLAN_VERSION_ID 
													FROM MODEL_EXEC 
													WHERE MEDIA_OUTLET_ID = :IN_MEDIA_OUTLET_ID AND PLAN_ID = :IN_PLAN_ID AND EXEC_STATUS_CD = 'C' limit 1
												) 
												SELECT EPISODE_DTL_JSON 
												FROM PR_PLAN_PROJECT_EPISODE_JSON 
												WHERE PLAN_ID = :IN_PLAN_ID AND PROJECT_ID = :IN_PROJECT_ID 
												AND PLAN_VERSION_ID = (SELECT V_PLAN_VERSION_ID FROM CTE_MAX_VERSION);`,

		multiNetDataFlag: `
							WITH CTE_PARAM AS(
        							SELECT :IN_PROJECT_ID AS PROJECT_ID,
                							:IN_MEDIA_OUTLET_ID AS MEDIA_OUTLET_ID
							)
							, CTE_PROJECT_LIST AS (
									SELECT CAST(value AS INT) AS PROJECT_ID 
									FROM TABLE(FLATTEN(INPUT => PARSE_JSON(SELECT PROJECT_ID FROM CTE_PARAM)))
							)
							SELECT tt.PROJECT_ID,CASE WHEN PGP.PROJECT_ID IS NULL THEN 'Prophet' ELSE 'MultiNet' END PLANNED_ON,
									PGP.GEO_PLAN_NAME
									FROM CTE_PROJECT_LIST tt
									LEFT JOIN PR_GEO_PROJECTS PGP ON PGP.PROJECT_ID=tt.PROJECT_ID
									AND PGP.MEDIA_OUTLET_ID=MEDIA_OUTLET_ID
									GROUP BY tt.PROJECT_ID,PGP.PROJECT_ID,PGP.GEO_PLAN_NAME; `,
	}

}