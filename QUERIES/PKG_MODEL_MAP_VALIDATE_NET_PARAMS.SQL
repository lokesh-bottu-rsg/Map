-- 1.IN_QTR
-- 2.IN_MEDIA_OUTLET_ID

WITH CTE_QTR AS (
    SELECT START_DATE V_START_DATE, END_DATE V_END_DATE FROM REF_CAL_PERIOD WHERE FISCAL_QTR = :IN_QTR
    and PERIOD_TYPE_CD='Q'
) -- SELECT * FROM CTE_QTR; 
SELECT VALIDATION_ID,VALIDATION_MESSAGE FROM (
            SELECT CASE WHEN count(1)= 0 THEN 1 END ERROR_ID from REF_DAYPART RD JOIN REF_DAYPART_DEFN RDD 
            ON RD.DAYPART_ID=RDD.DAYPART_ID WHERE MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
            AND RD.ACTIVE_YN='Y'
            UNION ALL 
            SELECT CASE WHEN count(1)=0 THEN 3 END ERROR_ID FROM REF_SPOTS_PER_HOUR  WHERE MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
            UNION ALL 
            SELECT CASE WHEN count(1)=0 THEN 2 END ERROR_ID FROM PR_PROMO_CAPACITY  WHERE MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID
            AND START_DATE>= (SELECT V_START_DATE FROM CTE_QTR) 
            AND END_DATE <= (SELECT V_END_DATE FROM CTE_QTR) 
        ) ERROR_NUM JOIN REF_MAP_VALIDATION RMV on ERROR_NUM.ERROR_ID=RMV.VALIDATION_ID;