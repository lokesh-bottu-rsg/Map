WITH CTE_NETWORK_ID AS(
        select MEDIA_OUTLET_ID from SEC_DIVISION_NETWORK where DIVISION_ID in 
        (select DIVISION_ID from SEC_DIVISION_NETWORK SDN
        where MEDIA_OUTLET_ID= :IN_MEDIA_OUTLET_ID AND ACTIVE_YN='Y' 
        and DIVISION_ID not in 
        (select DIVISION_ID from SEC_DIVISION where INCLUDE_IN_CLUSTER='N' AND ACTIVE_YN='Y'))
        AND ACTIVE_YN='Y'
)
,CTE_MEDIA_OUTLET_ID AS (
        select RMO.MEDIA_OUTLET_ID ,
        case when T.MEDIA_OUTLET_ID=:IN_MEDIA_OUTLET_ID then 1 when T.MEDIA_OUTLET_ID is null then 3 else 2 end CLUSTER_ID
        from REF_MEDIA_OUTLET RMO 
        LEFT JOIN CTE_NETWORK_ID T on T.MEDIA_OUTLET_ID=RMO.MEDIA_OUTLET_ID 
        where RMO.MEDIA_OUTLET_ID >0
)
,CTE_CLUSTER AS(
        SELECT :IN_USER_ID AS USER_ID,TT.MEDIA_OUTLET_ID, RC.CLUSTER_ID,RC.CLUSTER_NAME FROM REF_CLUSTER RC 
        JOIN CTE_MEDIA_OUTLET_ID TT ON RC.CLUSTER_ID=TT.CLUSTER_ID
        order by RC.CLUSTER_ID ASC
)
SELECT * FROM CTE_CLUSTER;